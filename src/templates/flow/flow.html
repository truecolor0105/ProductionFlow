{% extends "base.html" %}
{% load static %}

{% block css %}

    <!-- App favicon -->
    <link rel="shortcut icon" href="{% static 'assets/images/FAVICON_V001_TRANSPARENT.png' %}">

    <!-- Bootstrap Css -->
    <link href="{% static 'assets/css/bootstrap.min.css' %}" id="bootstrap-style" rel="stylesheet" type="text/css" />

    <!-- Icons Css -->
    <link href="{% static 'assets/css/icons.min.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'assets/libs/bootstrap-icons/font/bootstrap-icons.css' %}" rel="stylesheet" type="text/css" />

    <!-- App Css-->
    <link href="{% static 'assets/css/app.min.css' %}" id="app-style" rel="stylesheet" type="text/css" />

    <!-- dropzone css -->
    <link href="{% static 'assets/libs/dropzone/min/dropzone.min.css' %}" rel="stylesheet" type="text/css" />

    <!-- Context Menu -->
    <link href="{% static 'assets/libs/contextMenu/jquery.contextMenu.css' %}" rel="stylesheet" type="text/css" />

    <!-- Alertifyjs Css -->
    <link href="{% static 'assets/libs/alertifyjs/build/css/alertify.min.css' %}" rel="stylesheet" type="text/css" />

    <link href="{% static 'assets/libs/alertifyjs/build/css/themes/default.min.css' %}" rel="stylesheet" type="text/css" />

    <!-- Jquery Ui -->
    <link href="{% static 'assets/libs/jquery-ui/jquery-ui.css' %}" rel="stylesheet">

    <link href="{% static 'assets/libs/datetimepicker/jquery.datetimepicker.css' %}" rel="stylesheet" type="text/css" />
    <link href="{% static 'assets/libs/select2/select2.min.css' %}" rel="stylesheet" />

    <!-- Bootstrap datepicker CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css"/>
    {#    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" />#}
    <link rel="stylesheet" href="https://vjs.zencdn.net/7.19.2/video-js.css"/>




    <style type="text/css">

        #layout-wrapper div.container-fluid div.page-content div.container-fluid div.row div.col-xl-10 {
            background-color: white;
            border-radius: 20px;
            padding-top: 14px;
            padding-left: 20px;
        }
        .select2-container {
            width: 100% !important;
        }

        .select2-container--default .select2-selection--multiple .select2-selection__choice {
            background-color: #e9e9ef;
            border-color: transparent;
            border-radius: 4px;
            cursor: default;
            float: left;
            margin-right: 5px;
            margin-top: 5px;
        }

        .select2.select2-container.select2-container--default span.selection span.select2-selection.select2-selection--multiple {
            background: transparent;
            border: 1px solid #F6F8FC;
        }

        tr {
            line-height: 14px;
        }

        td {
            text-align: left;
            vertical-align: middle;
            word-wrap: break-word;
        }
        #nav-tab button{
            color: #1f87f0;
            font-weight: bold;
        }

        html body.pace-running div#layout-wrapper div.container-fluid div.page-content div.container-fluid div.row div.col-xl-2 div.row div.col-xl-12 ul.nav.nav-tabs li.nav-item a.nav-link span{
            color: #222222;
        }
        #modal_task_detail div.card{
            border: none;
        }

        ul.nav.nav-tabs li.nav-item a.nav-link {
            background-color: transparent;
            border:none;
            margin-right: 20px;
        }

        ul.nav.nav-tabs li.nav-item a.nav-link.active{
            border-bottom: 3px solid #1f87f0;
            padding-bottom: 7px;
        }

        ul.nav.nav-tabs li.nav-item a.nav-link.active span{
            color: #1f87f0;
        }

        ul.nav.nav-tabs li.nav-item a.nav-link span{
            margin-inline: -15px;
            color: #BDC8D7;
            font-weight: bold;
            font-size: 16px;
        }

        .nav-tabs {
            border-bottom: none
        }

        #nav_title > a.nav-link span{
            color: #1f87f0;
            font-weight: bold;
            font-size: 30px;
            margin-top: -10px;
        }

        #companyBox {
            background-color: white;
            position: absolute;
            display: none;
            width: 200px;
            z-index: 99999;
        }

        .status_color{
            width: 25px;
            height: 25px;
            border-radius: 50%;
        }

        input[type=color] {
            display: none;
        }

        .fixHeader {
            height: auto;
            overflow:auto;
            overflow-x: auto;
            scrollbar-width: thin;
        }
        #table_task{
            position: absolute;
            z-index: 1;
        }

        .fixHeader thead th, .fixHeader thead td{
            position: sticky;
            top: 0;
            z-index: 1;
            background-color: white;
        }
        .fixHeader  tr.task_row td:nth-child(1), .fixHeader  tr.task_row td:nth-child(2), .fixHeader  tr.task_row td:nth-child(3) {
            position: sticky;
            left: 0;
            z-index: 2;
            {#background-color: white;#}
        }
        .fixHeader  tr.task_folder_row td:nth-child(1), .fixHeader  tr.task_folder_row td:nth-child(2), .fixHeader  tr.task_folder_row td:nth-child(3) {
            position: sticky;
            left: 0;
            z-index: 2;
            {#background-color: white;#}
        }

        .task thead tr th{
            color: #BDC8D7;
        }
        .event_date_calender{
            top: auto !important;
            left: auto !important;
            display: none;
            position: relative;
        }

        .task_drag {
            overflow: hidden;
            position: relative;
        }
        .task_bar {
            background: #0090FF;
            height: calc(100% - 6px);
            width: 4px;
            position: absolute;
            right: 40%;
            top: 3px;
            border-radius: 5px;
        }
        .create_task_calendar{
            color: #BDC8D7;
            position: relative;
            z-index: 100;
            font-size: 20px;
            margin-top: -5px;
        }

        #tbody_calendar > tr > td{
            padding-top: 0;
            padding-bottom: 0;
            padding-left: 0;
            padding-right: 0;
        }

        .create_task_calendar_circle{
            opacity:0;
            width: 22px;
            height: 22px;
            background-color: #ececec;
            border-radius: 50%;
            padding-top: 1px;
            text-align: center;
            margin-left: auto;
            margin-right: auto;
        }


        #tbody_calendar > tr > td:hover .create_task_calendar_circle {
            opacity:1;
        }

        .task_dot{
            opacity:0;
        }

        .task_row:hover .task_dot {
            opacity:1;
        }

        .task_row:hover .task_bar {
            display: none;
        }

        table tbody tr.task_row td div.task_detail{
            display: none;
        }

        table tbody tr.task_row:hover div.task_detail{
            display: block;
        }

        span.task_detail{
            display: none;
        }
        .event:hover .task_detail{
            display: block;
        }

        .bi-trash, .bi-x{
            color: #979797;
            opacity: 0;
        }

        .project_drag {
            overflow: hidden;
            position: relative;
        }
        .project_bar {
            background: #0090FF;
            height: calc(100% - 6px);
            width: 4px;
            position: absolute;
            right: 40%;
            top: 3px;
            border-radius: 5px;
        }

        .project_dot{
            opacity: 0;
        }

        .project_row:hover .project_dot {
            opacity: 1;
        }

        .project_row:hover .project_bar {
            display: none;
        }


        .project_folder_row:hover .bi-trash{
            opacity: 1;
        }

        .project_row:hover .bi-trash{
            opacity: 1;
        }

        .task_folder_row:hover .bi-trash{
            opacity: 1;
        }

        .task_row:hover .bi-trash{
            opacity: 1;
        }

        .employee_row:hover .bi-trash{
            opacity: 1;
        }

        span.event:hover .bi-x{
            display: block;
        }

        .bi-check-circle, .bi-check-circle-fill{
            font-size: 18px;
            color: #BDC8D7;
        }

        .bi-grip-vertical{
            font-size: 18px;
            color: #b7b7b7;
            cursor: move;
        }

        .calendar{
            border-right: 0;
            border-left: 0;
            margin-top: 5px;
        }

        .calendar thead tr th{
            border-right: 0;
            border-left: 0;
        }

        .calendar tbody tr td:nth-child(1){
            border-top-color: white;
            border-left-color: white;
            border-bottom-color: white;
        }

        .calendar tbody  > tr {
            height: 25px;
        }

        .calendar > :not(:last-child) > :last-child > * {
            border-bottom-color: #e9e9ef;
            border-top-color: white;
        }

        tr > td > span.event {
            margin: 3px;
            padding: 4px;
            display: block;
            width: auto;
            color: #333;
            background-color: white;
            text-align: left;
            border-radius: 4px;
            filter: drop-shadow(1px 1px 2px #777);
            font-size: 12px;
        }

        tr > td > span.done *, tr > td > span.done {
            color:#BABABA;
            background-color:white;
            text-decoration: line-through;
        }

        .date_day {
            text-align: center;
        }

        .date_circle {
            width: 25px;
            height: 25px;
            background-color: #ececec;
            border-radius: 50%;
            padding-top: 5px;
            text-align: center;
            margin-top: 4px;
            margin-left: auto;
            margin-right: auto;
        }
        .event_date{
            background: #E15252;
            border-radius: 24px;
            text-align: center;
            padding: 6px;
            color: white;
            font-weight: bold;
        }
        .event_date.clock{
            background: transparent;
            text-align: center;
            color: #CDD6E1;
            font-size: 20px;
        }
        .task_detail_event_date{
            background: #E15252;
            border-radius: 24px;
            text-align: center;
            padding: 6px;
            color: white;
            font-weight: bold;
        }
        .task_detail_event_date.clock{
            background: transparent;
            text-align: center;
            color: #CDD6E1;
            font-size: 20px;
        }
        .task_outreach{
            background: #E15252;
            border-radius: 24px;
            text-align: center;
            padding: 6px;
            color: white;
            font-weight: bold;
        }
        .task_outreach.clock{
            background: transparent;
            text-align: center;
            color: #CDD6E1;
            font-size: 20px;
        }

        .task_status{
            border:0;
            outline:0;
            background:none;
            -webkit-appearance:none;
            appearance:none;
        }

        .bi-eye-slash, .bi-eye, .bi-people, .bi-envelope,  .task_detail, .bi-gear, .bi-folder-plus, .bi-trash,
        .bi-trash-fill, .event, .bi-check-circle-fill, .bi-check-circle, .bi-plus, .bi-plus-lg, .event_date,
        .bi-chevron-double-right,  .bi-chevron-double-left, .bi-chevron-right,  .bi-chevron-left,
        .bi-caret-right-fill, .bi-caret-down-fill, .bi-cloud-upload, .bi-cloud-download, .task_row > td:nth-child(4),
        .employee_row, .project_row, .play_video, #bulk_email_toggle, #smtp_configure_toggle
        {
            cursor: pointer;
        }

        .modal:nth-of-type(even) {
            z-index: 1062 !important;
        }
        .modal-backdrop.show:nth-of-type(even) {
            z-index: 1061 !important;
        }

        .grab {
            cursor: grab;
            cursor: -moz-grab;
            cursor: -webkit-grab;
        }

        .grab:active {
            cursor: move;
            cursor: -moz-grabbing;
            cursor: -webkit-grabbing;
        }

        .employee_row.select {
            background-color: #CCE8FF;
            color: #222222;
            display: block;
            border-radius: 20px;
            padding-left: 5px;
            width: 97%;
        }
        .employee_row:hover{
            background-color: #f2f2f2;
            color: #222222;
            display: block;
            border-radius: 20px;
            padding-left: 5px;
            width: 97%;
        }

        #table_project { border-collapse: separate; border-spacing: 0; }
        #table_project td { padding: 5px; }

        #table_project tr.project_row.select > td:nth-child(1) {
            background-color: #CCE8FF;
            border: 0px solid;
            border-right: 0;
            border-top-left-radius: 20px;
            border-bottom-left-radius: 20px;
        }

        #table_project tr.project_row.select > td:nth-child(2)  {
            background-color: #CCE8FF;
            border: 0px solid;
            border-left: 0;
            border-right: 0;
            padding-left: 5px;
        }

        #table_project tr.project_row.select > td:nth-child(3)  {
            background-color: #CCE8FF;
            border: 0px solid;
            border-left: 0;
            border-top-right-radius: 20px;
            border-bottom-right-radius: 20px;
        }

        #table_project tr.project_row:hover > td:nth-child(1) {
            background-color: #f2f2f2;
            border: 0px solid;
            border-right: 0;
            border-top-left-radius: 20px;
            border-bottom-left-radius: 20px;
        }

        #table_project tr.project_row:hover > td:nth-child(2)  {
            background-color: #f2f2f2;
            border: 0px solid;
            border-left: 0;
            border-right: 0;
            padding-left: 5px;
        }

        #table_project tr.project_row:hover > td:nth-child(3)  {
            background-color: #f2f2f2;
            border: 0px solid;
            border-left: 0;
            border-top-right-radius: 20px;
            border-bottom-right-radius: 20px;
        }


        tr > td.task_cb {
            background-color: dodgerblue;
        }

        tr.done > td {
            color:#999494;
            text-decoration: line-through;
        }

        tr.done > td.task_cb {
            background-color:#999494;
            text-decoration: line-through;
        }
        .video_version{
            text-align: center;
        }
        .video_version i{
            font-size: 2.5em;
        }

        #task_detail_name, #task_detail_notes, #task_detail_notes1, #task_detail_notes2,
        #task_detail_notes3, #task_detail_notes4, #task_detail_notes5, #task_detail_notes6,
        #task_detail_notes7, #task_detail_notes8, #task_detail_notes9{
            border: 1px solid #0d7aff;
        }

        #composemodal .modal-content {
            box-shadow: -2px 1px 10px rgba(0, 0, 0, 0.25);
            border-radius: 15px 15px 0 0;
        }

        #composemodal .modal-dialog {

            max-width: 800px;
            position: fixed;
            bottom: -3%;
            right: 0%;
        }
        #composemodal input, #composemodal select{
            border-bottom: none;
            border-right: none;
            border-left: none;
            border-radius: 0;
        }

        tr.selected > td, tr.selected > td.task_name {
            background-color: #E9F5FF;
            color: #222222;
        }

        /* For Chrome */
        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-track {
            background-color: #f5f5f5;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #b7b5b5;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-button {
            display: none;
        }

    </style>
{% endblock css %}

{% block content %}

    <div class="container-fluid">

        <div class="page-content">

            <div class="container-fluid">
                <div class="row">
                    <!-- left side -->
                    <div class="col-xl-2">

                        <!-- Contacts -->
                        <div class="row">
                            <div class="col-xl-12">
                                <div class="tab-content">
                                    <div class="row">
                                        <div class="col-md-2">
                                            <i style="font-size: 25px;" class="bi bi-people" id="btn_contacts"></i>
                                        </div>
                                        <div class="col-md-2">
                                            <i style="font-size: 25px;" class="bi bi-envelope" id="btn_email"></i>
                                        </div>
                                        <div class="col-md-8">
                                            <button class="btn" style="background-color: #CCE8FF; padding: 4px 8px 4px 8px; margin-top: 3px; border-radius: 7px;"  id="btn_sendbox" data-bs-toggle="modal" data-bs-target="#composemodal">
                                                <i class="bi bi-pencil-fill"></i> Compose
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr class="mt-2" style="background-color: #909193">

                        <!-- Employee -->
                        <div class="row">
                            <div class="col-xl-12">
                                <ul class="nav nav-tabs" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#people" role="tab">
                                            <span class="d-block d-sm-none"><i class="bi bi-person-fill"></i></span>
                                            <span class="d-none d-sm-block"><i class="bi bi-person-fill"></i> People</span>
                                        </a>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="people" role="tabpanel">
                                        <div style="max-height:300px; overflow-x: hidden; scrollbar-width: thin;">
                                            <div class="table-responsive">
                                                <table class="table table-borderless table-sm">
                                                    <div class="input-group" style="width: 97%">
                                                        <input type="email" class="form-control form-control-sm" placeholder="Invite Someone" id="invitation_email">
                                                        <button type="button" class="form-group form-control-sm btn-light" value="Invite" id="send_invitation" style="border:none;"><i class="bi bi-send"></i> </button>
                                                    </div>
                                                    <tbody id="tbody_employee"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr class="mt-2" style="background-color: #909193">

                        <!-- Project -->
                        <div class="row">
                            <div class="col-xl-12">
                                <ul class="nav nav-tabs" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#project" role="tab">
                                            <span class="d-block d-sm-none"><i class="bi bi-hammer"></i></span>
                                            <span class="d-none d-sm-block"><i class="bi bi-hammer"></i> Projects</span>
                                        </a>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="project" role="tabpanel">
                                        <div style="max-height:500px; overflow-x: hidden; scrollbar-width: thin; border: none;">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div style="padding-bottom: 15px;">
                                                        <i class="bi bi-plus create_project" folder_id="0" title="Add Project" style="font-size: 26px;font-weight: bolder; padding-left: 5px; color: mediumseagreen"></i>
                                                        <i class="bi bi-folder-plus" id="create_project_folder" title="Add Folder" style="font-size: 26px;font-weight: bolder; padding-left: 5px;"></i>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-borderless table-sm" id="table_project">
                                                    <tbody id="tbody_project"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr class="mt-2" style="background-color: #909193">


                    </div>

                    <!-- right side -->
                    <div class="col-xl-10">
                        <!-- All Apps -->
                        <div class="row">
                            <div class="col-xl-12">
                                <!-- Nav tabs -->
                                <ul class="nav nav-tabs" role="tablist">
                                    <li class="nav-item" id="nav_title" role="tab">
                                        <a class="nav-link">
                                            <span class="d-block d-sm-none"></span>
                                            <span class="d-none d-sm-block"></span>
                                        </a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link active" data-bs-toggle="tab" href="#tab_calendar" role="tab">
                                            <span class="d-block d-sm-none"><i class="bi bi-calendar-fill"></i></span>
                                            <span class="d-none d-sm-block"><i class="bi bi-calendar-fill"></i> Calender</span>
                                        </a>
                                    </li>


                                    <li class="nav-item section_tasklist">
                                        <a class="nav-link" data-bs-toggle="tab" href="#tab_tasklist" role="tab">
                                            <span class="d-block d-sm-none"><i class="bi bi-list-ul"></i></span>
                                            <span class="d-none d-sm-block"><i class="bi bi-list-ul"></i> Tasklist</span>
                                        </a>
                                    </li>

                                    <li class="nav-item section_contacts">
                                        <a class="nav-link" data-bs-toggle="tab" href="#tab_email" role="tab">
                                            <span class="d-block d-sm-none"><i class="bi bi-envelope"></i></span>
                                            <span class="d-none d-sm-block"><i class="bi bi-envelope"></i> Email</span>
                                        </a>
                                    </li>

                                    <li class="nav-item section_contacts">
                                        <a class="nav-link" data-bs-toggle="tab" href="#tab_contacts" role="tab">
                                            <span class="d-block d-sm-none"><i class="bi bi-people"></i></span>
                                            <span class="d-none d-sm-block"><i class="bi bi-people"></i> Contacts</span>
                                        </a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#tab_notes" role="tab">
                                            <span class="d-block d-sm-none"><i class="bi bi-card-list"></i></span>
                                            <span class="d-none d-sm-block"><i class="bi bi-card-list"></i> Notes</span>
                                        </a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link" data-bs-toggle="tab" href="#tab_metrics" role="tab">
                                            <span class="d-block d-sm-none"><i class="bi bi-table"></i></span>
                                            <span class="d-none d-sm-block"><i class="bi bi-table"></i> Metrics</span>
                                        </a>
                                    </li>

                                    <li class="nav-item" id="loading_task" style="display: none;">
                                        <a class="nav-link" role="tab">
                                            <span class="d-block d-sm-none">
                                                <img src="{% static 'assets\images\wait.gif' %}"  style="width: 20px; height: 20px;" />
                                            </span>
                                            <span class="d-none d-sm-block"><img src="{% static 'assets\images\wait.gif' %}"  style="width: 20px; height: 20px;" /> Loading Tasks...!</span>
                                        </a>
                                    </li>
                                </ul>

                                <!-- Tab panes -->
                                <div class="tab-content" style="margin-top: 12px;">
                                    <div class="tab-pane" id="tab_calendar" role="tabpanel">
                                        <div class="row">
                                            <div class="col-xl-8">
                                                <div class="row">
                                                    <div class="col-xl-6">
                                                        <div style="padding-bottom: 15px;">
                                                            <i>Shift All Events</i>
                                                            <i class="bi bi-chevron-double-left" id="task_move_left" move='left' title="Move All Tasks to Left" style="font-size: 15px; font-weight: bolder; padding-left: 5px;"></i>
                                                            <i class="bi bi-chevron-double-right" id="task_move_right" move="right" title="Move All Tasks to Right" style="font-size: 15px; font-weight: bolder; padding-left: 5px;"></i>
                                                        </div>
                                                    </div>
                                                    <div class="col-xl-6">
                                                        <div class="float-end" style="padding-bottom: 15px;">
                                                            <i id="calendar_month"></i>
                                                            <i class="bi bi-chevron-left" id="calendar_move_left" move='left' day="0" title="Move Calendar to Left" style="font-size: 15px; font-weight: bolder; padding-left: 5px;"></i>
                                                            <i class="bi bi-chevron-right" id="calendar_move_right" move="right" day="0" title="Move Calendar to Right" style="font-size: 15px; font-weight: bolder; padding-left: 5px;"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="table-responsive fixHeader">
                                                    <table class="table table-bordered table-sm calendar">
                                                        <thead id="thead_calendar"></thead>
                                                        <tbody id="tbody_calendar"></tbody>
                                                    </table>
                                                </div>
                                                <div class="row">
                                                    <div class="card">
                                                        <div class="card-body">
                                                            <iframe id="calendar_link" width="100%" height="1000px" src=""></iframe>
                                                        </div>
                                                        <div class="card-footer">
                                                            <label>Spreadsheet URL</label>
                                                            <input id="calendar_link_url" type="url" class="form-control" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xl-4">
                                                <div class="table-responsive fixHeader">
                                                    <table class="table table-borderless table-sm task" id="table_side_task">
                                                        <tbody id="tbody_side_task"></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="tab-pane" id="tab_tasklist" role="tabpanel">
                                        <div id="tab_tasklist_container" class="row">
                                            <div class="col-md-3">
                                                <div style="padding-bottom: 15px;">
                                                    <i class="bi bi-plus create_task" from="" title="Add Task" style="font-size: 26px;font-weight: bolder; padding-left: 5px; color: mediumseagreen"></i>
                                                    <i class="bi bi-folder-plus create_task_folder" title="Add Folder" style="font-size: 26px;font-weight: bolder; padding-left: 5px;"></i>
                                                    <i class="bi bi-gear" id="btn_status_setting" title="Status Settings" style="font-size: 26px;font-weight: bolder; padding-left: 5px"></i>
                                                    <i class="bi bi-eye-slash" title="Show Columns"  class="dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="font-size: 26px;font-weight: bolder; padding-left: 5px"></i>
                                                    <!--CSV Import and Export Button Truecolor-->
                                                    <i class="bi bi-cloud-download" id="btn_export_csv" style="font-size: 26px; font-weight: bolder; padding-left: 5px"></i>
                                                    <i class="bi bi-cloud-upload" id="btn_import_csv" style="font-size: 26px; font-weight: bolder; padding-left: 5px"></i>
                                                    <i class="bi bi-arrow-left-right bulk_move" style="font-size: 26px; font-weight: bolder; padding-left: 5px"></i>
                                                    <i class="bi bi-trash bulk_delete" style="font-size: 26px; font-weight: bolder; padding-left: 5px; opacity:1"></i>
                                                    <div class="dropdown-menu dropdownmenu-info" id="select_task_head"></div>
                                                </div>
                                            </div>
                                            <div class="fixHeader" style="height:650px">
                                                <table class="table table-sm task" id="table_task">
                                                    <thead id="thead_task"></thead>
                                                    <tbody id="tbody_task"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div id="import_container" style="display: none;">
                                            <div class="cu-import__container ng-star-inserted">
                                                <div class="cu-import__header ng-star-inserted">
                                                    <div class="cu-import__header-title"> Select Source of Import </div>
                                                </div>

                                                <div class="cu-import__container-top">
                                                    <div class="cu-integrations-wrapper">
                                                        <div class="cu-integrations-header ng-star-inserted">
                                                            <a class="cu-btn cu-integration-btn cu-integration-btn_row selected">
                                                                <div class="cu-integration-btn-icon cu-integration-btn-icon__csv">
                                                                    <img width="44" alt="" src="{% static 'assets/images/import/excel-csv-import.9bac71a354b8496f15cae8216cdd9e76.png' %}"></img>
                                                                </div>
                                                                <div class="cu-integration-btn__title"> Excel &amp; CSV </div>
                                                            </a>
                                                            <a class="cu-btn cu-integration-btn">
                                                                <div class="cu-integration-btn-icon cu-integration-btn-icon__asana">
                                                                    <img width="130" alt="" src="{% static 'assets/images/import/asana.2104066d2d95e43c589c09e3434ad9dd.png' %}"></img>
                                                                </div>
                                                            </a>
                                                            <a class="cu-btn cu-integration-btn">
                                                                <div class="cu-integration-btn-icon cu-integration-btn-icon__monday">
                                                                    <img width="155" alt="" src="{% static 'assets/images/import/monday.5e207dd131cd3a5c5bbea289af7d239f.svg' %}"></img>
                                                                </div>
                                                            </a>
                                                            <a class="cu-btn cu-integration-btn">
                                                                <div class="cu-integration-btn-icon cu-integration-btn-icon__trello">
                                                                    <img width="110" alt="" src="{% static 'assets/images/import/trello.360852a1c3c8594e84a3f0213efdefc7.svg' %}"></img>
                                                                </div>
                                                            </a>
                                                            <a class="cu-btn cu-integration-btn">
                                                                <div class="cu-integration-btn-icon cu-integration-btn-icon__todoist">
                                                                    <img width="110" alt="" src="{% static 'assets/images/import/todoist.65beb8ce35ca071e270691f20599ffa2.png' %}"></img>
                                                                </div>
                                                            </a>
                                                            <a class="cu-btn cu-integration-btn">
                                                                <div class="cu-integration-btn-icon cu-integration-btn-icon__basecamp">
                                                                    <img width="130" alt="" src="{% static 'assets/images/import/basecamp.7c23303299c16173ffa16bc180861088.svg' %}"></img>
                                                                </div>
                                                            </a>
                                                            <a class="cu-btn cu-integration-btn">
                                                                <div class="cu-integration-btn-icon cu-integration-btn-icon__wrike">
                                                                    <img width="80" alt="" src="{% static 'assets/images/import/wrike.dbfee22a562ee93cd22a48663ef9e7f7.svg' %}"></img>
                                                                </div>
                                                            </a>
                                                        </div>
                                                        <div class="cu-import__container-top-footer ng-star-inserted">
                                                            <div>
                                                                <button id="upload_button" class="cu-btn cu-btn_sm cu-btn_font-size-14 ng-star-inserted" style="position: relative">
                                                                    Import from CSV/Excel file
                                                                </button>
                                                                <input type="file" id="csvfile" style="display: none;"></input>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="cu-import__footer ng-star-inserted">
                                                    {% comment %} <a class="cu-import__footer-back" href="http://localhost:8000"> {% endcomment %}
                                                    <div class="cu-import__footer-back-arrow icon">
                                                    </div>
                                                    <div class="cu-import__footer-back-label" style="font-size: 16px; color: #7b68ee;">Back</div>
                                                    {% comment %} </a> {% endcomment %}
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="tab-pane" id="tab_email" role="tabpanel">

                                        <!-- start page title -->
                                        <div class="row">
                                            <div class="col-12">
                                                <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                                                    <h4 class="mb-sm-0 font-size-18">Inbox</h4>

                                                    <div class="page-title-right">
                                                        <ol class="breadcrumb m-0">
                                                            <li class="breadcrumb-item"><a href="javascript: void(0);">Email</a></li>
                                                            <li class="breadcrumb-item active">Inbox</li>
                                                        </ol>
                                                    </div>

                                                </div>
                                            </div>
                                        </div>
                                        <!-- end page title -->

                                        <div class="row">
                                            <div class="col-12">
                                                <!-- Left sidebar -->
                                                <div class="email-leftbar card">
                                                    <div class="mail-list mt-4">
                                                        <a href="#" class="active"><i class="mdi mdi-email-outline me-2"></i> Inbox <span class="ms-1 float-end">(18)</span></a>
                                                        <a href="#"><i class="mdi mdi-star-outline me-2"></i>Starred</a>
                                                        <a href="#"><i class="mdi mdi-diamond-stone me-2"></i>Important</a>
                                                        <a href="#"><i class="mdi mdi-file-outline me-2"></i>Draft</a>
                                                        <a href="#"><i class="mdi mdi-email-check-outline me-2"></i>Sent Mail</a>
                                                        <a href="#"><i class="mdi mdi-trash-can-outline me-2"></i>Trash</a>
                                                    </div>
                                                </div>
                                                <!-- End Left sidebar -->


                                                <!-- Right Sidebar -->
                                                <div class="email-rightbar mb-3">

                                                    <div class="card">
                                                        <div class="btn-toolbar p-3" role="toolbar">
                                                            <div class="btn-group me-2 mb-2 mb-sm-0">
                                                                <button type="button" class="btn btn-primary waves-light waves-effect"><i class="fa fa-inbox"></i></button>
                                                                <button type="button" class="btn btn-primary waves-light waves-effect"><i class="fa fa-exclamation-circle"></i></button>
                                                                <button type="button" class="btn btn-primary waves-light waves-effect"><i class="far fa-trash-alt"></i></button>
                                                            </div>
                                                            <div class="btn-group me-2 mb-2 mb-sm-0">
                                                                <button type="button" class="btn btn-primary waves-light waves-effect dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                                                    <i class="fa fa-folder"></i> <i class="mdi mdi-chevron-down ms-1"></i>
                                                                </button>
                                                                <div class="dropdown-menu">
                                                                    <a class="dropdown-item" href="#">Updates</a>
                                                                    <a class="dropdown-item" href="#">Social</a>
                                                                    <a class="dropdown-item" href="#">Team Manage</a>
                                                                </div>
                                                            </div>
                                                            <div class="btn-group me-2 mb-2 mb-sm-0">
                                                                <button type="button" class="btn btn-primary waves-light waves-effect dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                                                    <i class="fa fa-tag"></i> <i class="mdi mdi-chevron-down ms-1"></i>
                                                                </button>
                                                                <div class="dropdown-menu">
                                                                    <a class="dropdown-item" href="#">Updates</a>
                                                                    <a class="dropdown-item" href="#">Social</a>
                                                                    <a class="dropdown-item" href="#">Team Manage</a>
                                                                </div>
                                                            </div>

                                                            <div class="btn-group me-2 mb-2 mb-sm-0">
                                                                <button type="button" class="btn btn-primary waves-light waves-effect dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                                                    More <i class="mdi mdi-dots-vertical ms-2"></i>
                                                                </button>
                                                                <div class="dropdown-menu">
                                                                    <a class="dropdown-item" href="#">Mark as Unread</a>
                                                                    <a class="dropdown-item" href="#">Mark as Important</a>
                                                                    <a class="dropdown-item" href="#">Add to Tasks</a>
                                                                    <a class="dropdown-item" href="#">Add Star</a>
                                                                    <a class="dropdown-item" href="#">Mute</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <ul class="message-list">
                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk19">
                                                                        <label for="chk19" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">Peter, me (3)</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject">Hello – <span class="teaser">Trip home from Colombo has been arranged, then Jenna will come get me from Stockholm. :)</span>
                                                                    </a>
                                                                    <div class="date">Mar 6</div>
                                                                </div>
                                                            </li>

                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk20">
                                                                        <label for="chk20" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">me, Susanna (7)</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject"><span class="bg-warning badge me-2">Freelance</span>Since you asked... and i'm
                                                                        inconceivably bored at the train station –
                                                                        <span class="teaser">Alright thanks. I'll have to re-book that somehow, i'll get back to you.</span>
                                                                    </a>
                                                                    <div class="date">Mar. 6</div>
                                                                </div>
                                                            </li>

                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk6">
                                                                        <label for="chk6" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">Web Support Dennis</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject">Re: New mail settings –
                                                                        <span class="teaser">Will you answer him asap?</span>
                                                                    </a>
                                                                    <div class="date">Mar 7</div>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk7">
                                                                        <label for="chk7" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">me, Peter (2)</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject"><span class="bg-info badge me-2">Support</span>Off on Thursday -
                                                                        <span class="teaser">Eff that place, you might as well stay here with us instead! Sent from my iPhone 4  4 mar 2014 at 5:55 pm</span>
                                                                    </a>
                                                                    <div class="date">Mar 4</div>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk8">
                                                                        <label for="chk8" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">Medium</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject"><span class="bg-primary badge me-2">Social</span>This Week's Top Stories –
                                                                        <span class="teaser">Our top pick for you on Medium this week The Man Who Destroyed America’s Ego</span>
                                                                    </a>
                                                                    <div class="date">Feb 28</div>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk9">
                                                                        <label for="chk9" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">Death to Stock</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject">Montly High-Res Photos –
                                                                        <span class="teaser">To create this month's pack, we hosted a party with local musician Jared Mahone here in Columbus, Ohio.</span>
                                                                    </a>
                                                                    <div class="date">Feb 28</div>
                                                                </div>
                                                            </li>

                                                            <li class="unread">
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk3">
                                                                        <label for="chk3" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">Randy, me (5)</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject"><span class="bg-success badge me-2">Family</span>Last pic over my village –
                                                                        <span class="teaser">Yeah i'd like that! Do you remember the video you showed me of your train ride between Colombo and Kandy? The one with the mountain view? I would love to see that one again!</span>
                                                                    </a>
                                                                    <div class="date">5:01 am</div>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk4">
                                                                        <label for="chk4" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">Andrew Zimmer</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject">Mochila Beta: Subscription Confirmed
                                                                        – <span class="teaser">You've been confirmed! Welcome to the ruling class of the inbox. For your records, here is a copy of the information you submitted to us...</span>
                                                                    </a>
                                                                    <div class="date">Mar 8</div>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk5">
                                                                        <label for="chk5" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">Infinity HR</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject">Sveriges Hetaste sommarjobb –
                                                                        <span class="teaser">Hej Nicklas Sandell! Vi vill bjuda in dig till "First tour 2014", ett rekryteringsevent som erbjuder jobb på 16 semesterorter iSverige.</span>
                                                                    </a>
                                                                    <div class="date">Mar 8</div>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk10">
                                                                        <label for="chk10" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">Revibe</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject"><span class="bg-danger badge me-2">Friends</span>Weekend on Revibe –
                                                                        <span class="teaser">Today's Friday and we thought maybe you want some music inspiration for the weekend. Here are some trending tracks and playlists we think you should give a listen!</span>
                                                                    </a>
                                                                    <div class="date">Feb 27</div>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk11">
                                                                        <label for="chk11" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">Erik, me (5)</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject">Regarding our meeting –
                                                                        <span class="teaser">That's great, see you on Thursday!</span>
                                                                    </a>
                                                                    <div class="date">Feb 24</div>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk12">
                                                                        <label for="chk12" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">KanbanFlow</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject"><span class="bg-primary badge me-2">Social</span>Task assigned: Clone ARP's website
                                                                        – <span class="teaser">You have been assigned a task by Alex@Work on the board Web.</span>
                                                                    </a>
                                                                    <div class="date">Feb 24</div>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk13">
                                                                        <label for="chk13" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">Tobias Berggren</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject">Let's go fishing! –
                                                                        <span class="teaser">Hey, You wanna join me and Fred at the lake tomorrow? It'll be awesome.</span>
                                                                    </a>
                                                                    <div class="date">Feb 23</div>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk14">
                                                                        <label for="chk14" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">Charukaw, me (7)</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject">Hey man – <span class="teaser">Nah man sorry i don't. Should i get it?</span>
                                                                    </a>
                                                                    <div class="date">Feb 23</div>
                                                                </div>
                                                            </li>
                                                            <li class="unread">
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk15">
                                                                        <label for="chk15" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">me, Peter (5)</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject"><span class="bg-info badge me-2">Support</span>Home again! – <span class="teaser">That's just perfect! See you tomorrow.</span>
                                                                    </a>
                                                                    <div class="date">Feb 21</div>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk16">
                                                                        <label for="chk16" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">Stack Exchange</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject">1 new items in your Stackexchange inbox
                                                                        – <span class="teaser">The following items were added to your Stack Exchange global inbox since you last checked it.</span>
                                                                    </a>
                                                                    <div class="date">Feb 21</div>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk17">
                                                                        <label for="chk17" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">Google Drive Team</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject">You can now use your storage in Google
                                                                        Drive – <span class="teaser">Hey Nicklas Sandell! Thank you for purchasing extra storage space in Google Drive.</span>
                                                                    </a>
                                                                    <div class="date">Feb 20</div>
                                                                </div>
                                                            </li>
                                                            <li>
                                                                <div class="col-mail col-mail-1">
                                                                    <div class="checkbox-wrapper-mail">
                                                                        <input type="checkbox" id="chk18">
                                                                        <label for="chk18" class="toggle"></label>
                                                                    </div>
                                                                    <a href="#" class="title">me, Susanna (11)</a><span class="star-toggle far fa-star"></span>
                                                                </div>
                                                                <div class="col-mail col-mail-2">
                                                                    <a href="#" class="subject">Train/Bus – <span class="teaser">Yes ok, great! I'm not stuck in Stockholm anymore, we're making progress.</span>
                                                                    </a>
                                                                    <div class="date">Feb 19</div>
                                                                </div>
                                                            </li>

                                                        </ul>

                                                    </div> <!-- card -->

                                                    <div class="row">
                                                        <div class="col-7">
                                                            Showing 1 - 20 of 1,524
                                                        </div>
                                                        <div class="col-5">
                                                            <div class="btn-group float-end">
                                                                <button type="button" class="btn btn-sm btn-success waves-effect"><i class="fa fa-chevron-left"></i></button>
                                                                <button type="button" class="btn btn-sm btn-success waves-effect"><i class="fa fa-chevron-right"></i></button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div> <!-- end Col-9 -->

                                            </div>

                                        </div><!-- End row -->
                                    </div>

                                    <div class="tab-pane" id="tab_contacts" role="tabpanel">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div style="padding-bottom: 15px;">
                                                    <i class="bi bi-plus create_task" from="" title="Add Task" style="font-size: 26px;font-weight: bolder; padding-left: 5px; color: mediumseagreen"></i>
                                                    <i class="bi bi-folder-plus create_task_folder" title="Add Folder" style="font-size: 26px;font-weight: bolder; padding-left: 5px;"></i>
                                                    <i class="bi bi-gear" id="btn_status_setting" title="Status Settings" style="font-size: 26px;font-weight: bolder; padding-left: 5px"></i>
                                                    <i class="bi bi-eye-slash" title="Show Columns"  class="dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="font-size: 26px;font-weight: bolder; padding-left: 5px"></i>
                                                    <i class="bi bi-arrow-left-right bulk_move" style="font-size: 26px; font-weight: bolder; padding-left: 5px"></i>
                                                    <i class="bi bi-trash bulk_delete" style="font-size: 26px; font-weight: bolder; padding-left: 5px; opacity:1"></i>
                                                    <div class="dropdown-menu dropdownmenu-info" id="select_contacts_head">

                                                    </div>
                                                </div>
                                            </div>
                                            <div class="fixHeader" style="height:650px">
                                                <table class="table table-sm task" id="table_task">
                                                    <thead id="thead_contacts"></thead>
                                                    <tbody id="tbody_contacts"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="tab-pane" id="tab_notes" role="tabpanel">
                                        <div class="row"> <textarea id="user_notes" style="height: 600px"></textarea></div>
                                    </div>

                                    <div class="tab-pane" id="tab_metrics" role="tabpanel">
                                        <div class="row">
                                            <div class="card">
                                                <div class="card-body">
                                                    <iframe id="matrics_link" width="100%" height="1000px" src=""></iframe>
                                                </div>
                                                <div class="card-footer">
                                                    <label>Spreadsheet URL</label>
                                                    <input id="matrics_link_url" type="url" class="form-control" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End All Apps -->

                    </div>
                </div><!-- end row-->

            </div>
        </div>
        <!-- End Page-content -->
    </div>


    <!-- end main content-->
    <!-- task detail modal -->
    <div id="modal_task_detail" class="modal fade" tabindex="-1" aria-labelledby="modal_task_detail_label" aria-hidden="true" style="z-index: 1400;">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="col-xl-12">
                        <div class="float-start"><i class="bi bi-trash-fill" id="task_detail_delete" task_id="0"></i> &emsp; | &emsp; <input type="checkbox" id="task_detail_shift" task_id="0" /> &emsp;Lock Event Time</div>
                        <button type="button" class="btn-close float-end" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-xl-4">
                            <div class="card">
                                <div class="card-body">
                                    <form>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label">
                                                <div class="col-xl-12">
                                                    <i class="bi bi-check-circle tasK_detail_select_task float-start" task_id="0" id="task_detail_select"></i>
                                                </div>
                                            </label>
                                            <div class="col-xl-9" task_id="0" id="task_detail_name" contenteditable="true" spellcheck="false"></div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_project_title">Project</label>
                                            <div class="col-xl-9">
                                                <select class="form-select" id="task_detail_project" task_id="0"></select>
                                            </div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_event_title">Date</label>
                                            <div class="col-xl-9">
                                                <div id="task_detail_event" task_id="0"></div>
                                            </div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_status_title">Status</label>
                                            <div class="col-xl-9">
                                                <select class="form-select" id="task_detail_status" task_id="0"></select>
                                            </div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_employee_title">Person</label>
                                            <div class="col-xl-9">
                                                <select class="form-select task_detail_employee" id="task_detail_employee" name="task_detail_employee[]" task_id="0" multiple="multiple"></select>
                                            </div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_email_title">Email</label>
                                            <div class="col-xl-9">
                                                <input class="form-control" id="task_detail_email" task_id="0" value="" />
                                            </div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_notes_title">Notes</label>
                                            <div class="col-xl-9" id="task_detail_notes" task_id="0" contenteditable="true" spellcheck="false"></div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_notes1_title">Notes</label>
                                            <div class="col-xl-9" id="task_detail_notes1" task_id="0" contenteditable="true" spellcheck="false"></div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_notes2_title">Notes</label>
                                            <div class="col-xl-9" id="task_detail_notes2" task_id="0" contenteditable="true" spellcheck="false"></div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_notes3_title">Notes</label>
                                            <div class="col-xl-9" id="task_detail_notes3" task_id="0" contenteditable="true" spellcheck="false"></div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_notes4_title">Notes</label>
                                            <div class="col-xl-9" id="task_detail_notes4" task_id="0" contenteditable="true" spellcheck="false"></div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_notes5_title">Notes</label>
                                            <div class="col-xl-9" id="task_detail_notes5" task_id="0" contenteditable="true" spellcheck="false"></div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_notes6_title">Notes</label>
                                            <div class="col-xl-9" id="task_detail_notes6" task_id="0" contenteditable="true" spellcheck="false"></div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_notes7_title">Notes</label>
                                            <div class="col-xl-9" id="task_detail_notes7" task_id="0" contenteditable="true" spellcheck="false"></div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_notes8_title">Notes</label>
                                            <div class="col-xl-9" id="task_detail_notes8" task_id="0" contenteditable="true" spellcheck="false"></div>
                                        </div>
                                        <div class="row mb-4">
                                            <label class="col-xl-3 col-form-label" id="task_detail_notes9_title">Notes</label>
                                            <div class="col-xl-9" id="task_detail_notes9" task_id="0" contenteditable="true" spellcheck="false"></div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-4">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row" id="task_detail_video_list">
                                        {#                                        <div class="card" style="width:195px">#}
                                        {#                                            <img class="card-img-top" src="https://www.w3schools.com/bootstrap4/img_avatar1.png" alt="Card image" style="width:100%">#}
                                        {#                                            <div class="card-body">#}
                                        {#                                                <h4 class="card-title">John Doe</h4>#}
                                        {#                                                <a href="#" class="btn btn-primary">See Profile</a>#}
                                        {#                                            </div>#}
                                        {#                                        </div>#}

                                    </div>
                                    {##}
                                    <div class="row">
                                        <div class="col">
                                            <div class="position-relative">
                                                <input id="upload_file" class="form-control" name="files[]" type="file" >
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-4">
                            <div class="col-xl-12" style="background-color:red; height:300px"></div>
                            <div class="col-xl-12" style="background-color:green; height:300px"></div>
                        </div>
                    </div>

                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <!-- play video modal -->
    <div class="modal fade" id="modal_play_video" tabindex="-1" role="dialog" aria-hidden="true" style="z-index: 1600;">
        <div class="modal-dialog  modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Video</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-xl-8"><video id="vid_video" class="video-js vjs-default-skin vjs-16-9" controls preload="auto" poster="" data-setup="{}"></video>
                        </div>

                        <div class="col-xl-4">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <div class="position-relative">
                                                <input type="text" id="comment_comment" class="form-control border bg-soft-light" placeholder="Enter Message...">
                                                <label id="comment_time" class="float-end btn-outline-info">0:0:0</label>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <button type="button" id="comment_send" class="btn btn-primary chat-send w-md waves-effect waves-light"><span class="d-none d-sm-inline-block me-2">Send</span> <i class="mdi mdi-send float-end"></i></button>
                                        </div>
                                    </div>
                                    <div class="tab-content">
                                        <div class="tab-pane show active">
                                            <div class="chat-message-list" data-simplebar>
                                                <div class="pt-3">
                                                    <ul id="ul_video_comments" class="list-unstyled chat-list">
                                                        {#                                                        <li>#}
                                                        {#                                                            <a href="javascript:">#}
                                                        {#                                                                <div class="d-flex align-items-start">#}
                                                        {#                                                                    <div class="flex-shrink-0 user-img away align-self-center me-3">#}
                                                        {#                                                                        <span class="user-status"></span>#}
                                                        {#                                                                    </div>#}
                                                        {#                                                                    <div class="flex-grow-1 overflow-hidden">#}
                                                        {#                                                                        <h5 class="text-truncate font-size-14 mb-1">Burhan</h5>#}
                                                        {#                                                                        <p class="text-truncate mb-0">Add hanler at point three</p>#}
                                                        {#                                                                    </div>#}
                                                        {#                                                                    <div class="flex-shrink-0">#}
                                                        {#                                                                        <div class="font-size-11 comment_time" time="'+data.time+'">04:00</div>#}
                                                        {#                                                                    </div>#}
                                                        {#                                                                </div>#}
                                                        {#                                                            </a>#}
                                                        {#                                                        </li>#}
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>

    <!-- status setting modal -->
    <div class="modal fade" id="modal_status_setting" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Status Setting</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div style="max-height:300px; overflow:auto; scrollbar-width: thin;">
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm">
                                <tbody id="tbody_status" class="tbody_status"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>

    <!-- Bulk Move Modal -->
    <div class="modal" id="modal_bulk_move" tabindex="-1" role="dialog" aria-labelledby="modal_bulk_move_label" aria-hidden="true">

        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Bulk Move</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <select id="bulk_move_projects"></select>
                    <select id="bulk_move_folders"></select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="bulk_move">Move</button>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="modal_wait" tabindex="-1" aria-labelledby="modal_wait_label" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content" style="background-color: transparent !important; opacity: 0.4;">
                <img src="{% static 'assets\images\wait.gif' %}"  style="width: 100px; height: 100px; margin-left: 45%; margin-top: 25%;"/>
            </div>
        </div>
    </div>

    <div class="modal fade" id="composemodal" tabindex="-1" role="dialog" aria-labelledby="composemodalTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header" style="height: 40px;">
                    <h5 class="modal-title font-size-16" id="composemodalTitle"><i class="bi bi-envelope"></i> Compose New Email</h5>
                    <button type="button" class="btn" data-bs-dismiss="modal" aria-label="Close"><i class="bi bi-chevron-down"></i></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 col-lg-6"><b  style="color: #1f87f0;" id="bulk_email_toggle">Bulk Email</b></div>
                        <div class="col-md-6 col-lg-6"><b  style="color: #1f87f0;" id="smtp_configure_toggle" class="float-end">Smtp Config</b></div>
                    </div>

                    {#                    smtp config                    #}
                    <div class="row" id="smtp_configure" style="display: none;">
                        <div class="col-md-12 col-lg-12">
                            <input type="email" class="form-control" placeholder="SMTP Username" id="smtp_username">
                        </div>

                        <div class="col-md-12 col-lg-12">
                            <input type="text" class="form-control" placeholder="SMTP Password" id="smtp_password">
                        </div>

                        <div class="col-md-12 col-lg-12">
                            <input type="text" class="form-control" placeholder="SMTP Server Address" id="smtp_server">
                        </div>

                        <div class="col-md-12 col-lg-12">
                            <input type="number" class="form-control" placeholder="SMTP Server Port" id="smtp_port">
                        </div>

                    </div>

                    {#                    smtp config                    #}

                    {#                    bulk email                    #}

                    <div class="row" id="bulk_email" style="display: none;">
                        <div class="col-md-12 col-lg-12">
                            <select class="form-control" id="to_bulk_email" multiple="multiple"> </select>
                        </div>
                        <div class="col-md-12 col-lg-12">
                            <input class="form-control" id="to_bulk_email_exclude" placeholder="Exclude" />
                        </div>
                    </div>

                    {#                    bulk email                    #}

                    <div class="row">
                        <div class="col-md-12 col-lg-12">
                            <input type="email" class="form-control col-sm" placeholder="To" id="mail_to">
                        </div>
                        <div class="col-md-12 col-lg-12">
                            <input type="text" class="form-control" placeholder="Subject" id="mail_subject">
                        </div>
                        <div class="col-md-12 col-lg-12">
                            <textarea id="txt"></textarea>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-2 col-lg-2">
                            <button type="button" class="btn btn-rounded btn-info" id="send_email" style="margin-top: 10px; padding-inline: 22px;">Send &ensp;<i class="bi bi-send"></i> </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

{% endblock content %}


{% block js %}
    <!-- JAVASCRIPT -->
    <script src="{% static 'assets/libs/jquery/jquery.min.js' %}"></script>

    <script src="{% static 'assets/libs/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

    <script src="{% static 'assets/libs/metismenu/metisMenu.min.js' %}"></script>

    <script src="{% static 'assets/libs/simplebar/simplebar.min.js' %}"></script>

    <script src="{% static 'assets/libs/node-waves/waves.min.js' %}"></script>

    <script src="{% static 'assets/libs/feather-icons/feather.min.js' %}"></script>
    <!-- dropzone js -->

    <script src="{% static 'assets/libs/dropzone/min/dropzone.min.js' %}"></script>

    <!-- pace js -->
    <script src="{% static 'assets/libs/pace-js/pace.min.js' %}"></script>

    <!-- alertifyjs js -->
    <script src="{% static 'assets/libs/alertifyjs/build/alertify.min.js' %}"></script>
    <!-- Context Menu -->
    <script src="{% static 'assets/libs/contextMenu/jquery.contextMenu.js' %}" type="text/javascript"></script>
    <script src="{% static 'assets/libs/contextMenu/jquery.ui.position.min.js' %}" type="text/javascript"></script>

    <!-- jQUERY UI -->
    <script src="{% static 'assets/libs/jquery-ui/jquery-ui.js' %}" type="text/javascript"></script>
    <script src="{% static 'assets/libs/datetimepicker/build/jquery.datetimepicker.full.js' %}"></script>
    <script src="{% static 'assets/libs/drag_n_drop_column/dragndrop.table.columns.min.js' %}" type="text/javascript"></script>

    <!-- Bootstrap datepicker JS-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

    <script src="{% static 'assets/libs/select2/select2.full.min.js' %}"></script>

    <script src="https://vjs.zencdn.net/7.19.2/video.min.js"></script>

    <script src="https://cdn.jsdelivr.net/gh/linways/table-to-excel@v1.0.4/dist/tableToExcel.js"></script>
    <script src="https://cdn.tiny.cloud/1/vr5fjjwig91bbhx86nmpu18ij6k8e1hpg2gd0p7idt1imxj2/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>

    <script>
        $(function (){

            init();

            const weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]

            const free = '{{ free }}';
            let calendar_move = 0;
            let company_id = 0;
            let employee_id = 0;
            let project_id = 0;
            let task_id = 0;
            let status_preset_id = 0;
            let contacts_id = 0;
            let play_video_id = 0;

            let upload_task_id = 0;
            let upload_version_id = 0;
            const statusBox = '';
            let current_opened_tab = '#tab_calendar';
            let player = null;

            let event_search_by_click = false;
            let event_search_by_click_task_id = 0;
            let event_search_by_click_task_folder_id = 0;

            let task_from = '';
            let task_folder_from = '';
            let task_calendar_from = '';

            let company_list = [];
            let employee_list = [];
            let project_folder_list = [];
            let project_list = [];
            let task_folder_list = [];
            let task_list = [];

            var selected_task_rows = []
            const selected_task_list = [];
            let deleted_task_list = [];
            let project_status_list = [];
            const timeout = null;
            let select_task_head_options = []

            const tbody_product = $('#tbody_product');
            const tbody_company = $('#tbody_company');
            const company_dd = $('#company_dd');
            const tbody_employee = $('#tbody_employee');
            const tbody_project = $('#tbody_project');
            const tbody_contacts = $('#tbody_contacts');
            const tbody_task = $('#tbody_task');
            const tbody_side_task = $('#tbody_side_task');
            const tbody_status_preset = $('#tbody_status_preset');
            const tbody_status_list = $('#tbody_status_list');
            const tbody_default_status = $('#tbody_default_status');
            const tbody_status = $('#tbody_status');

            function init() {
                get_company();
                get_user_account();
            }

            {# Start Company #}


            function get_company() {
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_company',
                    method: 'get',
                    dataType: 'json',
                    success: function (data) {
                        tbody_company.empty();
                        let company_title = $('#company_title');
                        data.forEach(function(item, index) {
                            let tr = '';
                            tr += '<a class="dropdown-item company_row" href="javascript:;" company_id="'+item.id+'" ' ;
                            if(item.select === true) {
                                tr += 'style="background-color: lightgreen;"';
                                company_title.text(item.name);
                                company_title.attr('company_id',item.id);
                                company_id = item.id;
                            }
                            tr += '>'+item.name+'</a>';
                            tbody_company.append(tr);
                        });
                        tbody_company.append('<a class="dropdown-item btn btn-soft-secondary waves-effect waves-light btn-sm" id="add_company" href="javascript:;">Add Company </a>');

                        show_tab();
                        get_calendar();
                        get_employee();

                        get_project_folder();
                        get_status_preset();
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $(document).on('click', '.company_row', function() {
                company_id = ($(this).attr('company_id')).toString();

                $.ajax({
                    url: base_url + 'api_select',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_of':'company',
                        'company_id':company_id
                    },
                    success: function (data) {
                        if (data['success'] === true) {
                            init();
                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            });

            $(document).on('change keyup input paste', '#company_title', function() {
                let data_id = ($(this).attr('company_id')).toString();
                let data_value = $(this).text();
                let data_of = 'name';
                update_company(data_id, data_of, data_value);
            });

            function update_company(data_id, data_of, data_value){
                $.ajax({
                    url: base_url + 'api_update_company',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_id': data_id,
                        'data_of': data_of,
                        'data_value': data_value
                    },
                    success: function (data) {
                        if (data['success'] === true) {
                            $('#tbody_company > .company_row[company_id="'+data_id+'"]').text(data_value)
                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $(document).on('click', '#add_company', function() {

                window.open(base_url+'company',"_self")
            });

            $(document).on('keypress', '#invitation_email', function(e) {
                if(e.which === 13) {
                    send_invitation();
                }
            });

            $(document).on('click', '#send_invitation', function() {
                send_invitation();
            });

            function validateEmail($email) {
                let emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
                return emailReg.test( $email );
            }

            function send_invitation() {
                let email_to = $('#invitation_email').val();
                if( email_to === ''){
                    alertify.error("Please type Email");
                    return;
                }
                if(!validateEmail(email_to)) {
                    alertify.error("Please type Valid Email");
                    return;
                }
                alertify.confirm("Confirmation", "Do you want add new Member",
                    function(){
                        alertify.success("Sending..!")
                        $.ajax({
                            url: base_url + 'api_invite_in_company',
                            method: 'POST',
                            type: 'json',
                            data: {
                                'csrfmiddlewaretoken': '{{ csrf_token }}',
                                'company_id':company_id,
                                'email_to':email_to
                            },
                            success: function (data) {
                                if (data['success'] === true) {
                                    alertify.success("Send Successfully..!")
                                    $('#invitation_email').val('');

                                } else {
                                    alertify.error("Already added..!");
                                    console.log('error');
                                }
                            },
                            error: function () {
                                console.log('error');
                            }
                        });
                    },
                    function(){
                        alertify.error("Cancel");
                    }).set('defaultFocus', 'cancel');
            }

            function delete_company(){
                alertify.confirm("Confirmation", "Do you want Delete Company?",
                    function(){
                        alertify.success("Successfully Added..!")
                        $.ajax({
                            url: base_url + 'api_delete_company',
                            method: 'POST',
                            type: 'json',
                            data: {
                                'csrfmiddlewaretoken': '{{ csrf_token }}'
                            },
                            success: function (data) {
                                if (data['success'] === true) {
                                    init();

                                } else {
                                    console.log('error');
                                }
                            },
                            error: function () {
                                console.log('error');
                            }
                        });
                    },
                    function(){alertify.error("Cancel")}).set('defaultFocus', 'cancel');
            }

            function hide_company(){
                alertify.confirm("Confirmation", "Do you want Hide Company?",
                    function(){
                        alertify.success("Successfully Added..!")
                        $.ajax({
                            url: base_url + 'api_hide_company',
                            method: 'POST',
                            type: 'json',
                            data: {
                                'csrfmiddlewaretoken': '{{ csrf_token }}'
                            },
                            success: function (data) {
                                if (data['success'] === true) {
                                    init();

                                } else {
                                    console.log('error');
                                }
                            },
                            error: function () {
                                console.log('error');
                            }
                        });
                    },
                    function(){alertify.error("Cancel")}).set('defaultFocus', 'cancel');
            }
            {# End Company #}

            {# Start Calendar #}


            function get_calendar(){
                let date = new Date;
                let week_list = [];
                let calendar_th = '<tr><th width="6%" ></th>';
                let c_time = date.getTime();
                let get_time = date.getTime() + (86400000*calendar_move);
                let current_month = '';

                for (let day=-2; day<=4; day++) {
                    let current_date = new Date(get_time +(day * (24 * 60 * 60 * 1000)));

                    if(!current_month.includes(monthNames[current_date.getUTCMonth()])){
                        current_month += monthNames[current_date.getUTCMonth()] + ' - '
                    }

                    if(day === (-1*calendar_move)) {
                        calendar_th += '<th width="13.4%"><div class="date_day">'+ weekdays[current_date.getDay()]+'</div> <div class="date_circle" style="color:white; background-color: #E15252">'+current_date.getDate()+'</div></th>';
                    }else {
                        calendar_th += '<th width="13.4%"><div class="date_day">'+ weekdays[current_date.getDay()]+'</div> <div class="date_circle">'+current_date.getDate()+'</div></th>';
                    }
                    week_list.push(current_date);
                }
                calendar_th +='</tr>';
                $('#thead_calendar').html(calendar_th);

                let calendar_td = '';
                for (let hr=0; hr<24; hr++) {
                    let new_hr = '';
                    if (hr < 12){
                        new_hr = hr;
                        if(hr === 0){ new_hr = 12;}
                        calendar_td += '<tr><td width="25">'+new_hr+' AM</td>';
                    }
                    else{
                        new_hr = (hr-12);
                        if(new_hr === 0){ new_hr = 12;}
                        calendar_td += '<tr><td width="25">'+new_hr+' PM</td>';
                    }

                    for (let day=-2; day<=4; day++) {
                        let current_date = new Date(get_time +(day * (24 * 60 * 60 * 1000)));
                        let new_date = current_date.getFullYear() +'-'+ ( '0' + (current_date.getMonth()+1) ).slice( -2 ) +'-'+ current_date.getDate();
                        calendar_td += '<td class="parent form-group" date="'+new_date+'" time="'+hr+':00:00"><div class="create_task_calendar_circle"><i class="bi bi-plus create_task_calendar" from=""></i></div></td>';
                    }
                    calendar_td += '</tr>';
                }
                $('#tbody_calendar').html(calendar_td);
                $("td[date='"+date.getFullYear() +'-'+ ( '0' + (date.getMonth()+1) ).slice( -2 ) +'-'+ date.getDate()+"'][time='"+date.getHours()+":00:00']").css({'border-bottom':'3px solid red'});
                $('#calendar_month').html(current_month.replace(/-\s*$/, ""));
            }

            $(document).on('click', '#calendar_move_right, #calendar_move_left', function(event) {
                let move = $(this).attr('move');
                if(move === 'left'){
                    calendar_move -= 2;
                }else {
                    calendar_move += 2;
                }
                get_calendar();

                if($('#tbody_project tr.project_row.select').length>0){
                    get_project_calender();
                }
                if($('#tbody_employee tr.employee_row.select').length>0){
                    get_employee_calender();
                }
            });

            function render_calendar_event(data){
                let tz = (new Date()).getTimezoneOffset()/-60;
                data.forEach(function(item, index) {
                    let calendar_id = item.id;
                    let task_id = item.task_id;
                    let task_name = item.task;
                    let project_id = item.project_id;
                    let project_name = item.project_name;
                    let task_complete = item.complete;
                    let event_style = '';

                    let event_datetime = new Date(Date.parse(item.event_on) + ((tz) * 60 * 60 * 1000));
                    let event_date = event_datetime.getFullYear() +'-'+ ( '0' + (event_datetime.getMonth()+1) ).slice( -2 ) +'-'+ event_datetime.getDate();
                    let event_hour = event_datetime.getHours()+':00:00';

                    let td = $('#tbody_calendar tr td[date="'+event_date+'"][time="'+event_hour+'"]');
                    if(task_complete === true){event_style='done';}


                    if (td.length !== 0){
                        td[0].innerHTML += '' +
                            '<span class="event '+event_style+'" calendar_id="'+calendar_id+'" task_id="'+task_id+'" project_id="'+project_id+'" draggable="true" title="'+project_name+'">' +
                            '<i class="bi bi-x delete_event float-end" calendar_id="'+calendar_id+'" task_id="'+task_id+'" project_id="'+project_id+'"></i>' +
                            '<div style="width: 3px; height: calc(100% - 6px); background: #1c8ce3; position: absolute; border-radius: 3px; margin-top: -1px;"></div>' +
                            '<div style="margin-left: 10px;" class="">'+task_name+'</div>' +
                            '</span>';
                    }
                });
            }

            function get_project_calender(){
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_project_calendar',
                    method: 'get',
                    dataType: 'json',
                    data: {
                        'company_id':company_id,
                        'project_id':project_id
                    },
                    success: function (data) {
                        $('#tbody_calendar').find(".event").remove();
                        render_calendar_event(data)
                    }
                });
            }

            function get_employee_calender(){
                let date = new Date;
                let tz = (new Date()).getTimezoneOffset()/-60;
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_employee_calendar',
                    method: 'get',
                    dataType: 'json',
                    data:{
                        'employee_id': employee_id,
                        'company_id':company_id
                    },
                    success: function (data) {
                        $('#tbody_calendar').find(".event").remove();
                        render_calendar_event(data)
                    }
                });
            }


            $(document).on('click', '#task_move_right, #task_move_left', function(event) {
                let move = $(this).attr('move');
                alertify.confirm("Confirmation", "Do you want to shift Due Date of all events?",
                    function(){
                        $.ajax({
                            url: base_url + 'api_update_calendar_events',
                            method: 'POST',
                            type: 'json',
                            data: {
                                'csrfmiddlewaretoken': '{{ csrf_token }}',
                                'company_id': company_id,
                                'move':move
                            },
                            success: function (data) {
                                if (data['success'] === true) {
                                    alertify.success("Successfully Moved..!")

                                    if($('#tbody_project tr.project_row.select').length>0){
                                        get_project_calender();
                                    }
                                    if($('#tbody_employee tr.employee_row.select').length>0){
                                        get_employee_calender();
                                    }

                                } else {
                                    console.log('error');
                                }
                            },
                            error: function () {
                                console.log('error');
                            }
                        });
                    },
                    function(){alertify.error("Cancel")}).set('defaultFocus', 'cancel');
            });

            $(document).on('dblclick', '.event', function(event) {
                let ev_project_id = $(this).attr('project_id');
                let ev_task_id = $(this).attr('task_id');
                let ev_task_folder_id  = $("tr[task_id="+ev_task_id+"]").attr('parent_folder');

                $("#table_project > tbody > tr").each(function () {
                    let tr_project_id = $(this).attr('project_id')
                    if (tr_project_id !== undefined && parseInt(tr_project_id) === parseInt(ev_project_id)) {
                        event_search_by_click = true;
                        event_search_by_click_task_id = ev_task_id
                        event_search_by_click_task_folder_id = ev_task_folder_id
                        $(this).click();
                    }
                });
            });

            $(document).on('dragstart', '.task_dot', function(event) {
                let task_id = $(this).attr('task_id');
                let task_name = $("td[class='task_name'][task_id='"+task_id+"']").text();
                event.originalEvent.dataTransfer.setData('calendar_id', '0');
                event.originalEvent.dataTransfer.setData('task_id', task_id);
                event.originalEvent.dataTransfer.setData('task_name', task_name);
            });

            $(document).on('dragstart', '.event', function(event) {
                let calendar_id = $(this).attr('calendar_id');
                let task_id = $(this).attr('task_id');
                let task_name = $(this).text();
                event.originalEvent.dataTransfer.setData('calendar_id', calendar_id);
                event.originalEvent.dataTransfer.setData('task_id', task_id);
                event.originalEvent.dataTransfer.setData('task_name', task_name);
            });

            $(document).on('dragenter dragover drop', '.calendar td', function(event, ui) {
                event.preventDefault();
                if (event.type === 'drop') {
                    let calendar_id = event.originalEvent.dataTransfer.getData("calendar_id");
                    let task_id = event.originalEvent.dataTransfer.getData("task_id");
                    let task_name = event.originalEvent.dataTransfer.getData("task_name");
                    let task_time = $(this).attr('time');
                    let task_date = $(this).attr('date');

                    $('span[calendar_id="'+calendar_id+'"]').remove();
                    $(this).prepend('<span class="event" calendar_id="'+calendar_id+'" task_id="'+task_id+'" draggable="true"><i class="bi bi-x delete_event" calendar_id="'+calendar_id+'" task_id="'+task_id+'"></i>'+task_name+'</span>');
                    let icon = $("i[task_id='"+task_id+"']");
                    icon.removeClass('bi-calendar-fill')
                    icon.addClass('bi-calendar-check-fill')
                    let ed = new Date(Date.parse(task_date));
                    let calender_div ='<div class="event_date" task_id="'+task_id+'">'+ed.toLocaleString('default', { month: 'short' }) + ' ' +ed.getDate()+'</div><input type="text" class="event_date_calender" calendar_id="'+calendar_id+'" task_id="'+task_id+'" style="display: none">';
                    $('tr[task_id="'+task_id+'"] > td:nth-child(5)').html(calender_div);
                    update_calendar(calendar_id, task_id, task_date, task_time);
                }
            });

            {# show delete button on event div #}
            $(document).on('mouseover', '.event', function() {
                let calendar_id = $(this).attr('calendar_id');
                $("i[calendar_id='"+calendar_id+"']").css('display','block')
            });

            {# hide delete button on event div #}
            $(document).on('click', '.delete_event', function() {
                let calendar_id = ($(this).attr('calendar_id')).toString();
                alertify.confirm("Confirmation", "Do you want delete Event",
                    function(){
                        alertify.success("Successfully Deleted..!")
                        $.ajax({
                            url: base_url + 'api_delete_calendar',
                            method: 'POST',
                            type: 'json',
                            data: {
                                'csrfmiddlewaretoken': '{{ csrf_token }}',
                                'calendar_id': calendar_id,
                            },
                            success: function (data) {
                                if (data['success'] === true) {
                                    $("#tbody_calendar > tr > td > span[calendar_id='"+calendar_id+"']").remove();

                                } else {
                                    console.log('error');
                                }
                            },
                            error: function () {
                                console.log('error');
                            }
                        });
                    },
                    function(){alertify.error("Cancel")}).set('defaultFocus', 'cancel');
            });

            function update_calendar(calendar_id, task_id, task_date, task_time){
                let tz = (new Date()).getTimezoneOffset()/-60;
                let milliseconds = (new Date(""+task_date+" "+task_time+"")).getTime();
                let event_datetime = new Date((milliseconds) - ((tz) * 60 * 60 * 1000));
                let new_date = event_datetime.getFullYear() +'-'+ ( '0' + (event_datetime.getMonth()+1) ).slice( -2 ) +'-'+ event_datetime.getDate()+'T'+event_datetime.getHours()+':00:00';
                $.ajax({
                    url: base_url + 'api_update_calendar',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'calendar_id': calendar_id,
                        'task_id': task_id,
                        'task_datetime':new_date,
                        'company_id': company_id
                    },
                    success: function (data) {
                        if (data['success'] === true) {
                            $('span[calendar_id="0"]').attr('calendar_id',data['calendar'][0]['id']);
                            $('input[class="event_date_calender"][task_id="'+task_id+'"]').attr('calendar_id',data['calendar'][0]['id']);
                            $('span[calendar_id="'+data['calendar'][0]['id']+'"]').remove();
                            render_calendar_event(data['calendar'])
                            $('#tbody_side_task tr[task_id='+task_id+']').remove();
                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            {# End Calendar #}

            {# Start Employee #}

            function get_employee() {
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_employee',
                    method: 'get',
                    dataType: 'json',
                    data: {
                        'company_id': company_id
                    },
                    success: function (data) {
                        $('#tbody_employee > tr').remove();
                        employee_list = [];
                        let count = 1;
                        data.forEach(function(item, index) {
                            let tr = '';
                            if(item.select === true) {
                                employee_id = item.id;
                                tr += '<tr class="employee_row select" employee_id="'+item.id+'">';
                                $('#nav_title > a:nth-child(1) > span:nth-child(2)').html(item.user);
                                task_from = 'employee';
                                task_folder_from = 'employee'
                                task_calendar_from = 'employee'

                            }else {
                                tr += '<tr class="employee_row" employee_id="'+item.id+'">';
                            }
                            tr += '<td employee_id="'+item.id+'">'+item.user+'</td>';

                            {#if(item.owner === false){#}
                            {#    tr += '<td class="delete_employee" employee_id="'+item.id+'"><i class="bi bi-trash float-end"></i></td> ';#}
                            {# }else{#}
                            {#    tr += '<td></td> ';#}
                            {# }#}
                            tr += '</tr>';

                            count += 1;
                            tbody_employee.append(tr);
                            employee_list.push({'id':item.id, 'name':item.user});
                        });


                        $('.employee_row[employee_id="'+employee_id+'"]').click();

                        {#employee_list.forEach(function(item, index) {#}
                        {#    if(item.name === $("span.d-xl-inline-block").text()){#}
                        {#        $('.employee_row[employee_id="'+item.id+'"]').click();#}
                        {#    }#}
                        {# });#}

                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }
            $(document).on('click', '.delete_employee', function() {
                let data_id = ($(this).attr('employee_id')).toString();

                alertify.confirm("Confirmation", "Do you want Remove This",
                    function(){
                        $.ajax({
                            url: base_url + 'api_delete_employee',
                            method: 'POST',
                            type: 'json',
                            data: {
                                'csrfmiddlewaretoken': '{{ csrf_token }}',
                                'employee_id': data_id
                            },
                            success: function (data) {
                                if (data['success'] === true) {
                                    $('.employee_row[employee_id="'+data_id+'"]').remove();
                                    get_employee();
                                } else {
                                    console.log('error');
                                }
                            },
                            error: function () {
                                console.log('error');
                            }
                        });
                    },
                    function(){alertify.error("Cancel")}).set('defaultFocus', 'cancel');

            });
            function show_tab(){
                $.ajax({
                    url: base_url + 'api_show_tab',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'company_id': company_id
                    },
                    success: function (data) {
                        if (data['success'] === true) {
                            current_opened_tab = data['tab'];
                            {#if(data['tab'] === '#tab_contacts'){#}
                            {#    $('.section_tasklist').css('display', 'none');#}
                            {#    $('.section_contacts').css('display', 'block');#}
                            {#    #}
                            {# }else{#}
                            {#    $('.section_tasklist').css('display', 'block');#}
                            {#    $('.section_contacts').css('display', 'none');#}
                            {#    #}
                            {# }#}




                            {#$('li.nav-item > a').attr({'aria-selected':'false'}).removeClass('active');#}
                            {#$('li.nav-item > a[href="#tab_contacts"]').attr({'aria-selected':'true'}).addClass('active');#}
                            {#$('.col-xl-10 > div > div > div > div').removeClass('active');#}
                            {#$('#tab_contacts').addClass('active');#}
                            {#$(".employee_row").removeClass('select');#}
                            {#$(".project_row").removeClass('select');#}

                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }


            $(document).on('click', '.nav-link', function() {
                let tab = $(this).attr('href');
                if(
                    tab === '#tab_tasklist' || tab === '#tab_calendar' ||
                    tab === '#tab_notes' || tab === '#tab_metrics' ||
                    tab === '#tab_email' || tab === '#tab_contacts'
                ){
                    $.ajax({
                        url: base_url + 'api_select',
                        method: 'POST',
                        type: 'json',
                        data: {
                            'csrfmiddlewaretoken': '{{ csrf_token }}',
                            'company_id':company_id,
                            'data_of':'tab',
                            'tab':tab
                        },
                        success: function (data) {
                            if (data['success'] === true) {
                            } else {
                                console.log('error');
                            }
                        },
                        error: function () {
                            console.log('error');
                        }
                    });
                }
            });


            $(tbody_employee).on("click", ".employee_row", function(e) {
                employee_id = ($(this).attr('employee_id')).toString();
                task_calendar_from = 'employee';
                task_folder_from = 'employee';
                task_from = 'employee';
                $(".project_row").removeClass('select');
                $(".employee_row").removeClass('select');
                $(this).addClass('select');

                $('.section_tasklist').css('display', 'block');
                $('.section_contacts').css('display', 'none');
                $('li.nav-item > a').attr({'aria-selected':'false'}).removeClass('active');
                $('li.nav-item > a[href="#tab_tasklist"]').attr({'aria-selected':'true'}).addClass('active');
                $('.col-xl-10 > div > div > div > div').removeClass('active');
                $('#tab_tasklist').addClass('active');


                $('#tbody_project tr.project_row.btn-success.show').removeClass('btn-success btn-light').addClass('btn-light');
                $('#nav_title > a:nth-child(1) > span:nth-child(2)').html($(this).children('td').text());


                $.ajax({
                    url: base_url + 'api_select',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'company_id':company_id,
                        'data_of':'employee',
                        'employee_id':employee_id
                    },
                    success: function (data) {
                        if (data['success'] === true) {
                            get_employee_calender();
                            get_employee_task_folder();
                            {#get_employee_task();#}
                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            });

            {# End Employee #}

            {# Start Project #}

            function render_project_folder(folder) {
                let folderId = folder.id;
                let folderName = folder.name;
                let folder_tr = '';
                folder_tr += '<tr class="project_folder_row" folder_id="'+folderId+'">';
                folder_tr += '<td width="1%" title="Collapse rows" data-bs-toggle="collapse" data-bs-target=".project-folder-'+folderId+'" aria-expanded="true" class="project_folder">';
                folder_tr += '<i class="bi bi-caret-down-fill project_drag"></i>';
                folder_tr += '</td>';
                folder_tr += '<td class="project_folder_name" contenteditable="true" spellcheck="false" folder_id="'+folderId+'">'+folderName+'</td>';
                folder_tr += '<td width="15%"><i class="bi bi-plus float-start create_project" folder_id="'+folderId+'" title="Create Project" style="color: mediumseagreen"></i><i class="fa-regular bi-trash float-end delete_project_folder" title="Delete Project Folder" folder_id="'+folderId+'" ></i></td> ';
                folder_tr += '</tr>';
                return folder_tr;
            }

            {#$(document).on('click', '.project_folder_row > td > i', function() {#}
            {#    $(this).find('i').toggleClass('bi-caret-down-fill bi-caret-right-fill');#}
            {##}
            {# });#}

            function render_project(project) {
                let project_tr;
                let folderId;
                let projectId = project.id;
                let projectName = project.name;
                let projectSelect = '';

                if(project.folder !== null){
                    folderId = project.folder;
                }else {
                    folderId = 0;
                }
                if(project.select === true){
                    projectSelect = 'select';
                }

                project_tr += '<tr class="accordion-collapse collapse project-folder-'+folderId+' '+projectSelect+' project_row show"  project_folder_id="'+folderId+'" project_id="'+projectId+'">';
                project_tr += '<td class="project_drag"><div class="project_bar"></div><div class="project_dot"><i class="bi bi-grip-vertical project_drag" project_id="'+projectId+'"></i></div></td>';
                if(projectName === 'Misc.'){
                    project_tr += '<td class="project_name" project_id="'+projectId+'">'+projectName+'</td>';
                }else {
                    project_tr += '<td class="project_name" contenteditable="true" spellcheck="false" project_id="'+projectId+'">'+projectName+'</td>';
                }
                project_tr += '<td width="1%" class="delete_project" project_id="'+projectId+'" title="Delete Project"><i class="fa-regular bi-trash float-end" ></i></td> ';
                project_tr += '</tr>';
                return project_tr;
            }

            function get_project_folder() {
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_project_folder',
                    method: 'get',
                    dataType: 'json',
                    data: {
                        'company_id': company_id,
                        '': task_folder_from
                    },
                    success: function (data) {
                        project_folder_list = []
                        tbody_project.empty();
                        data.forEach(function(folder, index) {
                            $('#task_detail_project').append('<optgroup value="'+folder.id+'" label="'+folder.name+'"></optgroup>')
                            tbody_project.append(render_project_folder(folder));
                            project_folder_list.push({'id':folder.id, 'name':folder.name});
                        });
                        get_project();
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }


            function get_project() {
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_project',
                    method: 'get',
                    dataType: 'json',
                    data: {
                        'company_id': company_id
                    },
                    success: function (data) {
                        $('#bulk_move_projects').empty();
                        data.forEach(function(project, index) {
                            $('#bulk_move_projects').append('<option value="'+project.id+'">'+project.name+'</option>')
                            if(project.contacts === true){
                                contacts_id = project.id;
                            }
                            if(project.folder === null){
                                $('#task_detail_project').prepend('<option value="'+project.id+'">'+project.name+'</option>')
                            }else {
                                $('#task_detail_project optgroup[value="'+project.folder+'"]').append('<option value="'+project.id+'">'+project.name+'</option>')
                            }
                            if(project.folder === null){
                                if(project.contacts === false) {
                                    tbody_project.prepend(render_project(project))
                                }
                            }
                            else {
                                $('.project_folder_row[folder_id="'+project.folder+'"').after(render_project(project));
                            }

                            if(project.select === true && project.contacts === true){
                                $('.section_tasklist').css('display', 'none');
                                $('.section_contacts').css('display', 'block');
                                $('li.nav-item > a').attr({'aria-selected':'false'}).removeClass('active');
                                $('li.nav-item > a[href="'+current_opened_tab+'"]').attr({'aria-selected':'true'}).addClass('active');
                                $('.col-xl-10 > div > div > div > div').removeClass('active');
                                $(current_opened_tab).addClass('active');
                                $(".employee_row").removeClass('select');
                                $(".project_row").removeClass('select');

                                project_id = contacts_id;
                                task_calendar_from = 'contacts';
                                task_folder_from = 'contacts';
                                task_from = 'contacts';

                                $('#nav_title > a:nth-child(1) > span:nth-child(2)').html('Contacts');
                                contacts_id = project.id;
                                project_id = project.id;

                                get_project_calender();
                                get_task_head();
                                get_task_folder();
                                get_status();

                            }if(project.select === true && project.contacts === false){
                                $('.section_tasklist').css('display', 'block');
                                $('.section_contacts').css('display', 'none');
                                $('li.nav-item > a').attr({'aria-selected':'false'}).removeClass('active');
                                $('li.nav-item > a[href="'+current_opened_tab+'"]').attr({'aria-selected':'true'}).addClass('active');
                                $('.col-xl-10 > div > div > div > div').removeClass('active');
                                $(current_opened_tab).addClass('active');
                                $(".employee_row").removeClass('select');

                                task_calendar_from = 'project';
                                task_folder_from = 'project';
                                task_from = 'project';

                                $('#nav_title > a:nth-child(1) > span:nth-child(2)').html(project.name);

                                project_id = project.id;

                                get_project_calender();
                                get_task_head();
                                get_task_folder();
                                get_status();

                            }

                        });

                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $('select#bulk_move_projects').on('change', function() {
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_task_folder?project_id='+$(this).find(":selected").val(),
                    method: 'get',
                    dataType: 'json',
                    success: function (data) {
                        $('#bulk_move_folders').append('<option value="0">Select</option>')
                        data.forEach(function(folder, index) {
                            $('#bulk_move_folders').append('<option value="'+folder.id+'">'+folder.name+'</option>')
                        })
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            });

            $(document).on('click', '#bulk_move', function() {
                $.ajax({
                    url: base_url + 'api_bulk_task',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_of': 'move',
                        'data_value': selected_task_rows.toString(),
                        'project_id': $("select#bulk_move_projects option").filter(":selected").val(),
                        'folder_id': $("select#bulk_move_folders option").filter(":selected").val()
                    },
                    success: function (data) {
                        if (data['success'] === true) {
                            $('#modal_bulk_move').modal('toggle');
                            selected_task_rows.forEach(function(task_id, index) {
                                $('tr.task_row[task_id="'+task_id+'"]').remove();
                            })
                            selected_task_rows = []
                            alertify.success("Tasks Moved Successfully")
                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });

            })


            $(document).on('click', '.bulk_move', function() {
                if(selected_task_rows.length > 0) {
                    $('#modal_bulk_move').modal('toggle');
                    $('div[class="modal-backdrop show"]').remove();
                }else{
                    alertify.error("Please Select Atleast One Task")
                }
            });

            $(document).on('click', '.bulk_delete', function() {
                if(selected_task_rows.length > 0) {
                    alertify.confirm("Confirmation", "Do you want to Delete Selected Tasks",
                        function(){
                            $.ajax({
                                url: base_url + 'api_bulk_task',
                                method: 'POST',
                                type: 'json',
                                data: {
                                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                                    'data_of': 'delete',
                                    'data_value': selected_task_rows.toString(),
                                },
                                success: function (data) {
                                    if (data['success'] === true) {
                                        selected_task_rows.forEach(function(task_id, index) {
                                            $('tr.task_row[task_id="'+task_id+'"]').remove();
                                        })
                                        selected_task_rows = []
                                        alertify.success("Tasks Moved Successfully")
                                    } else {
                                        console.log('error');
                                    }
                                },
                                error: function () {
                                    console.log('error');
                                }
                            });
                        },
                        function(){alertify.error("Cancel")}
                    ).set('defaultFocus', 'cancel');

                }else{
                    alertify.error("Please Select Atleast One Task")
                }
            });


            $(document).on('click', '#btn_status_setting', function() {
                $('#modal_status_setting').modal('toggle');
                $('div[class="modal-backdrop fade show"]').remove();
            });

            $(document).on('click', '#create_project_folder', function() {
                $.ajax({
                    url: base_url + 'api_create_project_folder',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'company_id': company_id
                    },
                    success: function (data) {
                        if (data['success'] === true) {
                            tbody_project.prepend(render_project_folder(data['folder']));

                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            });

            $(document).on('change keyup input paste', '.project_folder_name', function() {
                let data_id = ($(this).attr('folder_id')).toString();
                let data_value = $(this).text();
                let data_of = 'name';
                update_project_folder(data_id, data_of, data_value)
            });

            function update_project_folder(data_id, data_of, data_value){
                $.ajax({
                    url: base_url + 'api_update_project_folder',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_id': data_id,
                        'data_of': data_of,
                        'data_value': data_value
                    },
                    success: function (data) {
                        if (data['success'] === true) {

                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $(document).on('click', '.delete_project_folder', function() {
                let folder_id = ($(this).attr('folder_id')).toString();
                let project_folder = $(this).closest('tr');

                alertify.confirm("Confirmation", "Do you want to Delete "+project_folder.find('.project_folder_name').text(),
                    function(){
                        project_folder.remove();
                        {#$('tr').attr('project_folder_id',folder_id).remove();#}
                        delete_project_folder(folder_id);
                    },
                    function(){alertify.error("Cancel")}
                ).set('defaultFocus', 'cancel');
            });

            $(document).on('click', '.create_project', function() {
                create_project(($(this).attr('folder_id')).toString())
            });

            function create_project(folder_id){
                if ($(tbody_status_preset).children().length === 1) {
                    alertify.error("Please Add Status Preset");
                    return;
                }
                $.ajax({
                    url: base_url + 'api_create_project',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'company_id': company_id,
                        'folder_id': folder_id
                    },
                    success: function (data) {
                        if (data['success'] === true) {
                            $(".project_row").removeClass('select');
                            if(folder_id === "0"){
                                tbody_project.prepend(render_project(data['project']));
                            }
                            else {
                                $('.project_folder_row[folder_id="'+folder_id+'"').after(render_project(data['project']));
                            }
                            $('.project_row[project_id="'+data['project'].id+'"]').click();

                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $(document).on('change keyup input paste', '.project_name', function() {
                let data_id = ($(this).attr('project_id')).toString();
                let data_value = $(this).text();
                let data_of = 'name';
                update_project(data_id, data_of, data_value)
            });

            function update_project(data_id, data_of, data_value){
                $.ajax({
                    url: base_url + 'api_update_project',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_id': data_id,
                        'data_of': data_of,
                        'data_value': data_value
                    },
                    success: function (data) {
                        if (data['success'] === true) {

                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $(document).on('click', '.delete_project', function() {
                project_id = ($(this).attr('project_id')).toString();
                let project = $(this).closest("tr");
                alertify.confirm("Confirmation", "Do you want to delete Project",
                    function(){
                        project.remove();
                        delete_project();
                        alertify.success("Successfully Deleted")
                    },
                    function(){alertify.error("Cancel")}
                ).set('defaultFocus', 'cancel');
            });

            function delete_project(){
                $.ajax({
                    url: base_url + 'api_delete_project',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'project_id': project_id
                    },
                    success: function (data) {
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            // delete project folder..
            $(document).on('click', '.delete_project_folder', function() {
                let folder_id = ($(this).attr('folder_id')).toString();
                let project_folder = $(this).closest('tr');

                alertify.confirm("Confirmation", "Do you want to Delete "+project_folder.find('.project_folder_name').text(),
                    function(){
                        $('#tbody_project>tr[project_folder_id="'+folder_id+'"]').remove();
                        project_folder.remove();
                        delete_project_folder(folder_id);
                    },
                    function(){alertify.error("Cancel")}
                ).set('defaultFocus', 'cancel');
            });

            function delete_project_folder(folder_id){
                $.ajax({
                    url: base_url + 'api_delete_project_folder',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'folder_id': folder_id
                    },
                    success: function (data) {
                        alertify.success("Successfully Deleted");
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $(tbody_project).on("click", ".project_row", function(e) {
                if(!$(this).hasClass('select')){
                    $(".employee_row").removeClass('select');
                    $(".project_row").removeClass('select');
                    $(this).addClass('select');

                    project_id = ($(this).attr('project_id')).toString();
                    task_calendar_from = 'project';
                    task_folder_from = 'project';
                    task_from = 'project';

                    $('.section_tasklist').css('display', 'block');
                    $('.section_contacts').css('display', 'none');
                    $('li.nav-item > a').attr({'aria-selected':'false'}).removeClass('active');
                    $('li.nav-item > a[href="#tab_tasklist"]').attr({'aria-selected':'true'}).addClass('active');
                    $('.col-xl-10 > div > div > div > div').removeClass('active');
                    $('#tab_tasklist').addClass('active');

                    $('#nav_title > a:nth-child(1) > span:nth-child(2)').html($(this).children('td').text());

                    $.ajax({
                        url: base_url + 'api_select',
                        method: 'POST',
                        type: 'json',
                        data: {
                            'csrfmiddlewaretoken': '{{ csrf_token }}',
                            'company_id': company_id,
                            'data_of': 'project',
                            'project_id': project_id
                        },
                        success: function (data) {
                            if (data['success'] === true) {
                                get_project_calender();
                                get_task_head();
                                get_task_folder();
                                get_status();
                            } else {
                                console.log('error');
                            }
                        },
                        error: function () {
                            console.log('error');
                        }
                    });
                }
            });

            {# End Project #}

            $(document).on('click', '#btn_email', function() {
                $('.section_tasklist').css('display', 'none');
                $('.section_contacts').css('display', 'block');
                $('li.nav-item > a').attr({'aria-selected':'false'}).removeClass('active');
                $('li.nav-item > a[href="#tab_email"]').attr({'aria-selected':'true'}).addClass('active');
                $('.col-xl-10 > div > div > div > div').removeClass('active');
                $('#tab_email').addClass('active');
            });

            $(document).on('click', '#btn_contacts', function() {
                $('.section_tasklist').css('display', 'none');
                $('.section_contacts').css('display', 'block');
                $('li.nav-item > a').attr({'aria-selected':'false'}).removeClass('active');
                $('li.nav-item > a[href="#tab_contacts"]').attr({'aria-selected':'true'}).addClass('active');
                $('.col-xl-10 > div > div > div > div').removeClass('active');
                $('#tab_contacts').addClass('active');
                $(".employee_row").removeClass('select');
                $(".project_row").removeClass('select');

                project_id = contacts_id;
                task_calendar_from = 'contacts';
                task_folder_from = 'contacts';
                task_from = 'contacts';

                $('#nav_title > a:nth-child(1) > span:nth-child(2)').html('Contacts');

                $.ajax({
                    url: base_url + 'api_select',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'company_id': company_id,
                        'data_of': 'project',
                        'project_id': project_id
                    },
                    success: function (data) {
                        if (data['success'] === true) {
                            get_project_calender();
                            get_task_head();
                            get_task_folder();
                            get_status();
                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });


            });


            {# Start Task #}

            let active_task_folder = '';
            let active_task = '';

            function render_task_folder(taskOf, folder){
                let folderId = folder.id;
                let folderName = folder.name;
                let projectName = folder.project;
                let class_name = 'project_task_folder_name';
                let tr = '<td class="'+class_name+'" colspan="10" task_folder_id="'+folderId+'" style="background-color: #F6F8FC; color: #60636b; font-weight:bold; font-size: 18px; padding: 8px;">'+folderName+'</td>';

                if(taskOf === 'employee'){
                    class_name = 'employee_task_folder_name';
                    folderName = '<b style="font-size:18px; color: #60636b;">'+projectName+'</b></br>'+folderName;
                    tr = '<td class="'+class_name+'" colspan="10" task_folder_id="'+folderId+'" style="background-color: #F6F8FC; color: #a8afbf; font-size: 12px; padding: 8px;">'+folderName+'</td>';
                }

                let folder_row = '';
                folder_row += '<tr class="task_folder_row" task_folder_id="'+folderId+'">';
                folder_row += '<td width="1%" title="Collapse rows task_folder" data-bs-toggle="collapse" data-bs-target=".task-folder-'+folderId+'" aria-expanded="true"><i class="bi bi-caret-right-fill task_calendar"></i></td>';
                folder_row += tr;
                folder_row += '<td class="float-start delete_task_folder" task_folder_id="'+folderId+'"><i class="bi bi-trash float-end" ></i></td>';
                folder_row += '</tr>';
                folder_row += '<tr class="accordion-collapse collapse task-folder-'+folderId+'" parent_folder="'+folderId+'" style="border-bottom-color: white;">';
                folder_row += '<td></td><td colspan="11" class="float-start create_task_of_folder" from="'+taskOf+'" task_folder_id="'+folderId+'"><i class="bi bi-plus float-end" style="color: mediumseagreen"></i></td></tr>';
                return folder_row;
            }

            $(document).on('click', '.task_folder_row td:not(.project_task_folder_name), .task_folder_row td:not(.employee_task_folder_name)', function() {
                $(this).find('i').toggleClass('bi-caret-down-fill bi-caret-right-fill');

            });

            function check_event(event_date){
                event_date = event_date.split('T')[0]
                let date = new Date;
                let start_date = new Date(date.getTime() + (-3 * (24 * 60 * 60 * 1000)));
                let end_date = new Date(date.getTime() + (3 * (24 * 60 * 60 * 1000)));
                if(event_date !== '0000-00-00'){
                    let Ed = new Date(event_date)
                    return Ed < start_date || Ed > end_date;
                }else{
                    return false;
                }
            }

            function render_task(taskOf, task, taskType){

                let folderId = task.folder_id;
                let taskId = task.id;
                let taskName = task.name;
                let taskEmail = task.email;
                let taskNotes = task.notes;
                let taskNotes1 = task.notes1;
                let taskNotes2 = task.notes2;
                let taskNotes3 = task.notes3;
                let taskNotes4 = task.notes4;
                let taskNotes5 = task.notes5;
                let taskNotes6 = task.notes6;
                let taskNotes7 = task.notes7;
                let taskNotes8 = task.notes8;
                let taskNotes9 = task.notes9;
                let taskStatusId = task.status_id;
                let taskStatusList = task.status_list;
                let taskEmployee = task.employee;
                let taskOutreach = task.outreach;
                let taskActive = true
                let taskEvent = task.event;
                let taskIsEvent = task.is_event;
                let taskThumbnail_url = task.thumbnail_url;
                let taskShow = false;

                let task_row = '';
                let side_task_row = '';
                let employee_options = '';
                let text_style = '';
                let active_event = '';
                let task_event_date = '';
                let task_event_month= '';
                let calender_div = '';
                let outreach_div = '';
                let task_employee_list = [];
                let cb_checked = 'bi bi-check-circle';
                let status_options = '';
                let selected_color = '';
                let done_task = false;
                let task_style = '';

                taskStatusList.forEach(function(item, index) {
                    if(taskStatusId === item.id){
                        status_options += '<option value="'+item.id+'" style="background-color: '+item.color+';" selected>'+item.name+'</option>';
                        selected_color = item.color;

                        if('Done' === item.name){
                            done_task=true;
                            task_style='done';
                            cb_checked = 'bi bi-check-circle-fill';
                        }else{
                            task_style='pending';
                        }

                    }else {
                        status_options += '<option value="'+item.id+'" style="background-color: '+item.color+';">'+item.name+'</option>';
                    }
                });

                if(taskNotes === null){taskNotes = ''}

                if(taskNotes1 === null){taskNotes1 = ''}

                if(taskEvent !== "0000-00-00T00-00-00"){
                    let tz = (new Date()).getTimezoneOffset()/-60;
                    let event_datetime = new Date(Date.parse(taskEvent) + ((tz) * 60 * 60 * 1000));
                    task_event_month = event_datetime.toLocaleString('default', { month: 'short' });
                    task_event_date = event_datetime.getDate();
                    calender_div ='<div class="event_date" task_id="'+taskId+'">'+task_event_month + ' ' +task_event_date+'</div><input type="text" class="event_date_calender" calendar_id="0" task_id="'+taskId+'" style="display: none">';
                }
                else {
                    calender_div ='<div class="event_date clock" task_id="'+taskId+'"><i class="bi bi-clock-fill"></i></div><input type="text" class="event_date_calender" calendar_id="0" task_id="'+taskId+'" style="display: none">';
                }

                if(taskOutreach !== ''){
                    let end = new Date();
                    let numbers = taskOutreach.match(/\d+/g);
                    let start_date = new Date(numbers[2], numbers[0]-1, numbers[1]);
                    let outreach  = Math.round(((end- start_date) / (1000 * 60 * 60 * 24)));
                    outreach_div ='<div class="task_outreach" task_id="'+taskId+'">'+outreach+'</div><input type="text" class="task_outreach_calender" task_id="'+taskId+'" style="display: none">';
                }
                else {
                    outreach_div ='<div class="task_outreach clock" task_id="'+taskId+'"><i class="bi bi-clock-fill"></i></div><input type="text" class="task_outreach_calender" task_id="'+taskId+'" style="display: none">';
                }

                if (taskEmployee !== null){task_employee_list = (taskEmployee).split(',').map(Number);}
                employee_list.forEach(function(item, index) {
                    if(jQuery.inArray(item.id, task_employee_list) !== -1){
                        employee_options += '<option value="'+item.id+'" selected>'+item.name+'</option>';
                    }else {
                        employee_options += '<option value="'+item.id+'">'+item.name+'</option>';
                    }
                });

                if(event_search_by_click === true){
                    active_task_folder = '.task-folder-'+event_search_by_click_task_folder_id;
                    active_task = event_search_by_click_task_id;
                }else {
                    if(taskActive === true) {
                        active_task_folder = '.task-folder-'+folderId;
                        active_task = taskId;
                        task_style += ' select'
                    }
                }
                let task_show = ''
                if(taskShow === true || folderId === 0){
                    task_show = 'show'
                }

                task_row += '<tr class="accordion-collapse task_row '+taskType+' '+task_style+' task-folder-'+folderId+' '+task_show+' collapse" id="task-folder-'+folderId+'" data-bs-parent="#task-folder-'+folderId+'" task_id="'+taskId+'" parent_folder="'+folderId+'">';
                task_row += '<td style="min-width: 5px" class="task_drag"><div class="task_bar"></div><div class="task_dot"><i class="bi bi-grip-vertical task_calendar" task_id="'+taskId+'" task_of="'+taskOf+'"></i></div></td>';
                task_row += '<td style="min-width: 5px"><div><i class="'+cb_checked+' select_task" task_id="'+taskId+'" task_of="'+taskOf+'"></i></div></td>';
                task_row += '<td style="min-width: 500px" class="task_name" task_id="'+taskId+'" contenteditable="true" spellcheck="false">'+ taskName +'</td>';
                task_row += '<td style="min-width: 65px; border-left: none;"><div class="task_detail float-end" task_id="'+taskId+'" task_of="'+taskOf+'" title="Open Task Detail">Open &nbsp;<i class="bi bi-box-arrow-up-right"></i></div></td>';
                task_row += '<td style="min-width: 70px" style="text-align: center;">'+calender_div+'</td>';
                task_row += '<td style="min-width: 70px" style="text-align: center;">'+outreach_div+'</td>';

                task_row += '<td style="width: 195px; height:109px;">';
                if(taskThumbnail_url !== ''){
                    task_row += '<img class="card-img-top task_detail" task_id="'+taskId+'" task_of="'+taskOf+'" src="'+taskThumbnail_url+'" alt="No Thumbnail">';
                }
                task_row += '</td>';
                task_row += '<td style="min-width: 100px" task_id="'+taskId+'" style="background-color:'+selected_color+';"><select class="form-select task_status" task_id="'+taskId+'" style="background-color:'+selected_color+';">'+status_options+'</select></td>';
                task_row += '<td style="min-width: 100px"><select class="form-select task_employee" task_id="'+taskId+'" name="task_employee[]" multiple="multiple">'+employee_options+'</select></td>';
                {#task_row += '<td style="min-width: 10px" class="video_version" task_id="'+taskId+'"> <i class="bi bi-play-btn-fill"></i> </td>';#}
                task_row += '<td style="min-width: 100px" class="task_email" task_id="'+taskId+'" contenteditable="true" spellcheck="false">'+ taskEmail +'</td>';
                task_row += '<td style="min-width: 100px" class="task_notes" task_id="'+taskId+'" contenteditable="true" spellcheck="false">'+ taskNotes +'</td>';
                task_row += '<td style="min-width: 100px" class="task_notes1" task_id="'+taskId+'" contenteditable="true" spellcheck="false">'+ taskNotes1 +'</td>';
                task_row += '<td style="min-width: 100px" class="task_notes2" task_id="'+taskId+'" contenteditable="true" spellcheck="false">'+ taskNotes2 +'</td>';
                task_row += '<td style="min-width: 100px" class="task_notes3" task_id="'+taskId+'" contenteditable="true" spellcheck="false">'+ taskNotes3 +'</td>';
                task_row += '<td style="min-width: 100px" class="task_notes4" task_id="'+taskId+'" contenteditable="true" spellcheck="false">'+ taskNotes4 +'</td>';
                task_row += '<td style="min-width: 100px" class="task_notes5" task_id="'+taskId+'" contenteditable="true" spellcheck="false">'+ taskNotes5 +'</td>';
                task_row += '<td style="min-width: 100px" class="task_notes6" task_id="'+taskId+'" contenteditable="true" spellcheck="false">'+ taskNotes6 +'</td>';
                task_row += '<td style="min-width: 100px" class="task_notes7" task_id="'+taskId+'" contenteditable="true" spellcheck="false">'+ taskNotes7 +'</td>';
                task_row += '<td style="min-width: 100px" class="task_notes8" task_id="'+taskId+'" contenteditable="true" spellcheck="false">'+ taskNotes8 +'</td>';
                task_row += '<td style="min-width: 100px" class="task_notes9" task_id="'+taskId+'" contenteditable="true" spellcheck="false">'+ taskNotes9 +'</td>';
                task_row += '<td style="min-width: 50px" class="delete_task" task_id="'+taskId+'"><i class="fa-regular bi-trash float-end" ></i></td> ';
                task_row += '</tr>';

                if(taskOf==='employee' && done_task === true){task_row = '';}

                if(taskIsEvent === false || (taskIsEvent === true && check_event(taskEvent) === true) ){
                    side_task_row += '<tr class="accordion-collapse collapse task_row '+task_style+' task-folder-'+folderId+' '+task_show+'" id="task-folder-'+folderId+'" data-bs-parent="#task-folder-'+folderId+'" task_id="'+taskId+'" parent_folder="'+folderId+'">';
                    side_task_row += '<td style="min-width: 5px" class="task_drag"><div class="task_bar"></div><div class="task_dot" task_id="'+taskId+'" draggable="true"><i class="bi bi-grip-vertical task_calendar" task_id="'+taskId+'" task_of="'+taskOf+'"></i></div></td>';
                    {#side_task_row += '<td style="min-width: 5px" class="task_drag"><div class="task_bar"></div><div class="task_dot" task_id="'+taskId+'" draggable="true"><i class="fas fa-grip-vertical"></i></div></td>';#}
                    side_task_row += '<td style="min-width: 5px"><div><i class="'+cb_checked+' select_task" task_id="'+taskId+'" task_of="'+taskOf+'"></i></div></td>';
                    side_task_row += '<td style="min-width: 500px" class="task_name" task_id="'+taskId+'" contenteditable="true" spellcheck="false">'+ taskName +'</td>';
                    side_task_row += '<td style="min-width: 25px" class="task_detail" task_id="'+taskId+'" task_of="'+taskOf+'"><i class="bi bi-box-arrow-up-right"></i></td> ';
                    side_task_row += '<td style="min-width: 25px" class="delete_task" task_id="'+taskId+'"><i class="fa-regular bi-trash float-end" ></i></td> ';
                    side_task_row += '</tr>';
                }

                return {'task_row': task_row, 'side_task_row':side_task_row};
            }

            $(document).on('click', '.event > div:nth-child(3)', function() {
                task_id = $(this).closest('.event').attr('task_id');
                get_task_detail();

            });

            $(document).on('click', '.task_detail', function() {
                task_id = $(this).attr('task_id');
                get_task_detail();

            });
            function get_task_detail() {
                $('#modal_task_detail').modal('toggle');
                $('div[class="modal-backdrop fade show"]').remove();
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_task_detail',
                    method: 'get',
                    dataType: 'json',
                    data: { 'task_id': task_id },
                    success: function (data) {
                        $( "#task_detail_shift").prop({'checked':false});
                        $('#task_detail_name').html('');
                        $('#task_detail_email').val('');
                        $('#task_detail_notes').html('');
                        $('#task_detail_notes1').html('');
                        $('#task_detail_notes2').html('');
                        $('#task_detail_notes3').html('');
                        $('#task_detail_notes4').html('');
                        $('#task_detail_notes5').html('');
                        $('#task_detail_notes6').html('');
                        $('#task_detail_notes7').html('');
                        $('#task_detail_notes8').html('');
                        $('#task_detail_notes9').html('');
                        $('#task_detail_event').html('');
                        $('#task_detail_select').html('');
                        $('#task_detail_status').html('');
                        $('#task_detail_employee').html('');
                        $("task_detail_project option:selected").attr('selected',false)
                        $('#task_detail_video_list').empty();
                        $('#task_detail_name_title').html(data[0]['task_head'][2]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][2]['id']});
                        $('#task_detail_event_title').html(data[0]['task_head'][3]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][3]['id']});
                        $('#task_detail_status_title').html(data[0]['task_head'][5]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][5]['id']});
                        $('#task_detail_employee_title').html(data[0]['task_head'][6]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][6]['id']});
                        $('#task_detail_email_title').html(data[0]['task_head'][7]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][7]['id']});
                        $('#task_detail_notes_title').html(data[0]['task_head'][8]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][8]['id']});
                        $('#task_detail_notes1_title').html(data[0]['task_head'][9]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][9]['id']});
                        $('#task_detail_notes2_title').html(data[0]['task_head'][10]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][10]['id']});
                        $('#task_detail_notes3_title').html(data[0]['task_head'][11]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][11]['id']});
                        $('#task_detail_notes4_title').html(data[0]['task_head'][12]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][12]['id']});
                        $('#task_detail_notes5_title').html(data[0]['task_head'][13]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][13]['id']});
                        $('#task_detail_notes6_title').html(data[0]['task_head'][14]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][14]['id']});
                        $('#task_detail_notes7_title').html(data[0]['task_head'][15]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][15]['id']});
                        $('#task_detail_notes8_title').html(data[0]['task_head'][16]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][16]['id']});
                        $('#task_detail_notes9_title').html(data[0]['task_head'][17]['name']); //.attr({'contenteditable': true, 'head_id': data[0]['task_head'][17]['id']});
                        {#$('#task_detail_select_title').html(data[0]['task_head'][]['name']);#}

                        data.forEach(function(item, index) {
                            if(item.shift === true){
                                $( "#task_detail_shift").prop('checked',true);
                            }
                            $('#task_detail_shift').attr('task_id',task_id);
                            $('#task_detail_delete').attr('task_id',task_id);
                            $('#task_detail_name').html(item.name).attr('task_id',task_id);
                            $('#task_detail_email').val(item.email).attr('task_id',task_id);
                            $('#task_detail_notes').html(item.notes).attr('task_id',task_id);
                            $('#task_detail_notes1').html(item.notes1).attr('task_id',task_id);
                            $('#task_detail_notes2').html(item.notes2).attr('task_id',task_id);
                            $('#task_detail_notes3').html(item.notes3).attr('task_id',task_id);
                            $('#task_detail_notes4').html(item.notes4).attr('task_id',task_id);
                            $('#task_detail_notes5').html(item.notes5).attr('task_id',task_id);
                            $('#task_detail_notes6').html(item.notes6).attr('task_id',task_id);
                            $('#task_detail_notes7').html(item.notes7).attr('task_id',task_id);
                            $('#task_detail_notes8').html(item.notes8).attr('task_id',task_id);
                            $('#task_detail_notes9').html(item.notes9).attr('task_id',task_id);
                            $("#task_detail_project").attr('task_id', task_id).find("option[value='"+item.project_id+"']").prop('selected', true);

                            let calender_div = '';
                            let task_event_date = '';
                            let task_event_month= '';
                            if(item.event !== "0000-00-00T00-00-00"){
                                let tz = (new Date()).getTimezoneOffset()/-60;
                                let event_datetime = new Date(Date.parse(item.event) + ((tz) * 60 * 60 * 1000));
                                task_event_month = event_datetime.toLocaleString('default', { month: 'short' });
                                task_event_date = event_datetime.getDate();
                                calender_div ='<div class="task_detail_event_date" task_id="'+task_id+'">'+task_event_month+' '+task_event_date+'</div><input type="text" class="task_detail_event_date_calender" calendar_id="0" task_id="'+task_id+'" style="display: none">';
                            }else {
                                calender_div ='<div class="task_detail_event_date clock" task_id="'+task_id+'"><i class="bi bi-clock-fill"></i></div><input type="text" class="task_detail_event_date_calender" calendar_id="0" task_id="'+task_id+'" style="display: none">';
                            }
                            $('#task_detail_event').html(calender_div);


                            item.files.forEach(function(file, index) {
                                $('#task_detail_video_list').append('<div class="card play_video" task_id="'+task_id+'" file_id="'+file.id+'" url="'+file.file+'" style="width:195px"><img class="card-img-top" src="'+file.thumbnail+'" alt="Card image" style="width:100%" /></div>');
                            });

                            let cb_checked = 'bi bi-check-circle';
                            let status_options = '';
                            let selected_color = '';
                            let done_task = false;
                            let task_style = '';
                            $('#task_detail_select').removeClass('bi-check-circle-fill bi-check-circle');
                            let status_id = item.status_id;

                            item.status_list.forEach(function(item, index) {
                                if(status_id === item.id){
                                    status_options += '<option value="'+item.id+'" style="background-color: '+item.color+';" selected>'+item.name+'</option>';
                                    selected_color = item.color;
                                    if('Done' === item.name){
                                        done_task=true;
                                        task_style='done';
                                        cb_checked = 'bi bi-check-circle-fill';
                                    }else{
                                        task_style='pending';
                                    }
                                }else {
                                    status_options += '<option value="'+item.id+'" style="background-color: '+item.color+';">'+item.name+'</option>';
                                }
                            });
                            $('#task_detail_status').append(status_options).attr('task_id',task_id).css({"background-color":selected_color});
                            $('#task_detail_select').addClass(cb_checked).attr('task_id',task_id);

                            let taskEmployee = item.employee;
                            let employee_options = '';
                            let task_employee_list = [];
                            if (taskEmployee !== null){task_employee_list = (taskEmployee).split(',').map(Number);}

                            employee_list.forEach(function(item, index) {
                                if(jQuery.inArray(item.id, task_employee_list) !== -1){
                                    $('#task_detail_employee').append('<option value="'+item.id+'" selected>'+item.name+'</option>');
                                }else {
                                    $('#task_detail_employee').append('<option value="'+item.id+'">'+item.name+'</option>');
                                }
                            });
                            $('#task_detail_employee').attr('task_id',task_id);
                        });
                    },
                    error: function () {
                        console.log('error');
                    }
                });

                $('#task_detail_employee').select2({
                    dropdownParent: $('#modal_task_detail'),
                    placeholder: "+",
                    tags: true,
                    allowClear: true,
                    createTag: function (params) {
                        if (params.term.indexOf('@') === -1) {return null;}
                        return { id: params.term, text: params.term }
                    }
                });
            }

            $(document).on('click', '.task_outreach', function() {
                let event_task_id = $(this).attr('task_id');
                $('input[class="task_outreach_calender"][task_id="'+event_task_id+'"]').show().focus().hide();
                $('.datepicker').css({'z-index':'9999'});
                jQuery("td.day:contains("+new Date().getDate()+")" ).css({"background-color":'#22222'});
            });

            $(document).on('change set', '.task_outreach_calender', function() {
                let event_task_id = $(this).attr('task_id');
                let start = $(this).datepicker("getDate");
                let end= new Date();
                let from = start.getMonth() +1+'-'+start.getDate()+'-'+start.getFullYear();
                let numbers = from.match(/\d+/g);
                let start_date = new Date(numbers[2], numbers[0]-1, numbers[1]);
                let outreach  = Math.round(((end- start_date) / (1000 * 60 * 60 * 24)));
                $('tbody tr td div.task_outreach[task_id="'+event_task_id+'"]').html(outreach).removeClass('clock')
                $(this).datepicker('hide');
                update_task(event_task_id, 'outreach', from);
            });

            $(document).on('click', '.event_date', function() {
                let event_task_id = $(this).attr('task_id');
                $('input[class="event_date_calender"][task_id="'+event_task_id+'"]').show().focus().hide();
                $('.datepicker').css({'z-index':'9999'});
                jQuery("td.day:contains("+new Date().getDate()+")" ).css({"background-color":'#22222'});
            });

            $(document).on('change set', '.event_date_calender', function() {
                let event_task_id = $(this).attr('task_id');
                let calendar_id = $(this).attr('calendar_id');
                let event_datetime = $(this).datepicker("getDate");
                let task_event_month = event_datetime.toLocaleString('default', { month: 'short' });
                let task_event_date = event_datetime.getDate();

                $('tbody tr td div.event_date[task_id="'+event_task_id+'"]').html(task_event_month + ' ' +task_event_date).removeClass('clock')
                $('#tbody_side_task tr[task_id="'+event_task_id+'"]').remove();
                $(this).datepicker('hide');

                let m = event_datetime.getMonth() +1;
                let y = event_datetime.getFullYear();
                update_calendar(calendar_id, event_task_id, y+'-'+m+'-'+task_event_date, '00:00:00');
            });


            $(document).on('click', '.task_detail_event_date', function() {
                let event_task_id = $(this).attr('task_id');
                $('.task_detail_event_date_calender[task_id="'+event_task_id+'"]').datepicker({
                    format:'Y-m-d', container: "#modal_task_detail",
                });
                $('.task_detail_event_date_calender[task_id="'+event_task_id+'"]').show().focus().hide();
                $('.datepicker').css({'z-index':'1600 !important'});
                jQuery("td.day:contains("+new Date().getDate()+")" ).css({"background-color":'#22222'});
            });

            $(document).on('change set', '.task_detail_event_date_calender', function() {
                let event_task_id = $(this).attr('task_id');
                let calendar_id = $(this).attr('calendar_id');
                let event_datetime = $(this).datepicker("getDate");
                let task_event_month = event_datetime.toLocaleString('default', {month: 'short'});
                let task_event_date = event_datetime.getDate();
                $('.task_detail_event_date[task_id="'+event_task_id+'"]').html(task_event_month + ' ' +task_event_date).removeClass('clock')
                $('#tbody_side_task tr[task_id="'+event_task_id+'"]').remove();
                $(this).datepicker('hide');
                let m = event_datetime.getMonth() +1;
                let y = event_datetime.getFullYear();
                update_calendar(calendar_id, event_task_id, y+'-'+m+'-'+task_event_date, '00:00:00');
            });


            $(document).on('click', '.create_task_folder', function() {
                $.ajax({
                    url: base_url + 'api_create_task_folder',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'company_id': company_id,
                        'project_id': project_id,
                        'folder_from':task_folder_from
                    },
                    success: function (data) {
                        if (data['success'] === true) {
                            let current_tbody= null;
                            if(task_folder_from === 'contacts'){
                                current_tbody = tbody_contacts
                            }else{
                                current_tbody = tbody_task
                            }
                            let task_folder = current_tbody.find('.task_folder_row:first');

                            if(task_folder.length === 0){
                                current_tbody.append(render_task_folder(task_folder_from, data['folder']))
                                tbody_side_task.append(render_task_folder(task_folder_from, data['folder']))
                            }else {
                                task_folder.before(render_task_folder(task_folder_from, data['folder']))
                                tbody_side_task.before(render_task_folder(task_folder_from, data['folder']))
                            }
                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            });


            function render_comments(data){
                let li = '';
                let checked = '';

                if(data.active === true){ checked = 'checked'}

                li += '<li class="comment_row">';
                li += '<a href="javascript:">';
                li += '<div class="d-flex align-items-start">';
                li += '<div class="flex-shrink-0 user-img away align-self-center me-3">';
                li += '<input type="checkbox" class="form-group" file_id="'+data.id+'" '+checked+'/>';
                {#li += '<span class="user-status"></span>';#}
                li += '</div>';
                li += '<div class="flex-grow-1 overflow-hidden">';
                li += '<h5 class="text-truncate font-size-14 mb-1">'+data.creator+'</h5>';
                li += '<p class="text-truncate mb-0">'+data.comment+'</p>';
                li += '</div>';
                li += '<div class="flex-shrink-0">';
                li += '<div class="font-size-11 comment_time" time="'+data.time+'">'+data.time+'</div>';
                li += '</div>';
                li += '</div>';
                li += '</a>';
                li += '</li>';

                return li;
            }


            function secondsToHms(d) {
                d = Number(d);
                return (Math.floor(d / 3600)) + ":" + (Math.floor((d % 3600) / 60)) + ":" + (Math.floor((d % 3600) % 60));
            }

            $(document).on('click', '.play_video', function() {
                play_video_id = $(this).attr('file_id');
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_video_comment',
                    method: 'get',
                    dataType: 'json',
                    data: {
                        'file_id': play_video_id
                    },
                    success: function (data) {
                        let ul_video_comments =  $('#ul_video_comments');
                        ul_video_comments.children().remove();
                        data.forEach(function(comment, index) {
                            ul_video_comments.append(render_comments(comment))
                        });
                    },
                    error: function () {
                        console.log('error');
                    }
                });

                player = videojs(document.querySelector('.video-js'));
                player.src({ src: $(this).attr('url'), type: 'video/mp4'});
                player.play();
                player.on('timeupdate', function () {
                    $('#comment_time').html(secondsToHms(player.currentTime()));
                });

                $('#modal_play_video').modal('show');
            });

            $('#modal_play_video').on('hidden.bs.modal', function () {
                player.pause();
                player.src({ src: ''});
            });

            $(document).on('click', '#comment_send', function() {
                let comment = $('#comment_comment').val();
                let comment_time = $('#comment_time').html();
                if(comment === ''){
                    alertify.error('Please Add Comment')
                    return;
                }
                $.ajax({
                    url: base_url + 'api_create_video_comment',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'file_id': play_video_id,
                        'comment_time': comment_time,
                        'comment': comment
                    },
                    success: function (data) {
                        if (data['success'] === true) {
                            $('#comment_comment').val('');
                            $('#ul_video_comments').prepend(render_comments(data['item']))
                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            });

            function update_video_comment(data_id, data_of, data_value){
                $.ajax({
                    url: base_url + 'api_update_video_comment',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_id': data_id,
                        'data_of': data_of,
                        'data_value': data_value
                    },
                    success: function (data) {
                        if (data['success'] === true) {

                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }
            $(document).on('click', '.comment_row:not(input[type=checkbox])', function() {
                const a = $(this).find('.comment_time').attr('time').split(':');
                player.currentTime((+a[0]) * 60 * 60 + (+a[1]) * 60 + (+a[2]));
                player.pause();
            });

            $(document).on('change', 'li.comment_row a div div input[type=checkbox]', function() {
                let data_id = ($(this).attr('file_id')).toString();
                let data_value = 0;
                if ($(this).is(':checked')) { data_value = 1 }

                update_video_comment(data_id, 'active', data_value);
            })

            $(document).on('change', '#upload_file', function() {
                let form_data = new FormData();
                form_data.append("files[]", $('#upload_file')[0].files[0]);
                form_data.append("csrfmiddlewaretoken",  '{{ csrf_token }}');
                form_data.append("task_id",task_id);

                $.ajax({
                    url: base_url + 'api_upload_video',
                    dataType: 'json',
                    cache: false,
                    contentType: false,
                    processData: false,
                    data: form_data,
                    type: 'post',
                    xhr: function() {
                        $('#task_detail_video_list').prepend('<div class="card play_video new_video" task_id="'+task_id+'" file_id="" url="" style="width:195px"><img class="card-img-top" src="{% static 'assets/images/video_loading.gif' %}" alt="image" style="width:100%" /><div class="card-body"><div class="progress"><div id="upload_progress_bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuemin="0" aria-valuemax="100">0%</div></div></div></div>');

                        const xhr = new window.XMLHttpRequest();
                        xhr.upload.addEventListener("progress", function(evt) {
                            if (evt.lengthComputable) {
                                let percentComplete = evt.loaded / evt.total;
                                percentComplete = parseInt(percentComplete * 100);
                                {#console.log('Uploading..('+percentComplete+'%)')#}
                                let pb = $('#upload_progress_bar');
                                pb.html('Uploading..('+percentComplete+'%)');
                                pb.css({'width':percentComplete+'%'})
                            }
                        }, false);

                        return xhr;
                    },
                    success: function (response) {
                        $('#upload_file').val('');
                        $('#upload_progress_bar').css({'width':'0%'})
                        create_video_thumbnail(response['task_video_id'])
                    },
                    error: function (response) {
                        $('#upload_file').val('');
                        $('#upload_progress_bar').css({'width':'0%'})
                        $('#modal_upload_file').modal('hide');
                        console.log('error')
                    }
                });
            });

            function create_video_thumbnail(file_id){
                $.ajax({
                    url: base_url + 'api_create_video_thumbnail',
                    method: 'POST',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'file_id': file_id
                    },
                    success: function (data) {
                        let new_video = $('.new_video');
                        new_video.attr('file_id', data['data']['file_id']);
                        new_video.attr('url', data['data']['file_url']);
                        new_video.find('img').attr('src', data['data']['image_url']);
                        new_video.removeClass('new_video');
                        $('.task_row[task_id="'+task_id+'"]').find('td>img').attr('src', data['data']['image_url']);
                        alertify.success('File Uploaded Successfully')
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }


            $(document).on('click', '.create_task', function() {
                create_task({'task_from': task_from, 'company_id': company_id, 'project_id': project_id, 'folder_id': 0, 'employee_id': employee_id, 'task_datetime': '' });
            });

            $(document).on('click', '.create_task_of_folder', function() {
                create_task({'task_from':task_from, 'company_id':company_id, 'project_id':project_id, 'folder_id':$(this).attr('task_folder_id'), 'employee_id':employee_id, 'task_datetime':''})
            });

            $(document).on('click', '.create_task_calendar', function() {
                let task_date = $(this).closest('td').attr('date');
                let task_time = $(this).closest('td').attr('time');
                let tz = (new Date()).getTimezoneOffset()/-60;
                let milliseconds = (new Date(""+task_date+" "+task_time+"")).getTime();
                let event_datetime = new Date((milliseconds) - ((tz) * 60 * 60 * 1000));
                let new_date = event_datetime.getFullYear() +'-'+ ( '0' + (event_datetime.getMonth()+1) ).slice( -2 ) +'-'+ event_datetime.getDate()+'T'+event_datetime.getHours()+':00:00';
                create_task({'task_from':task_calendar_from, 'company_id':company_id, 'project_id':project_id, 'folder_id':0, 'employee_id':employee_id, 'task_datetime':new_date})
            });

            function create_task(data){
                $.ajax({
                    url: base_url + 'api_create_task',
                    method: 'POST',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_value': JSON.stringify(data)
                    },
                    success: function (data) {
                        let current_tbody= null;
                        let inactive_heads =  [];
                        if(task_from === 'contacts'){
                            current_tbody = tbody_contacts
                            $('#select_contacts_head input:checkbox:not(:checked)').each(function () {
                                inactive_heads.push($('#thead_contacts > tr > td[head_id="'+$(this).attr('head_id')+'"]').index())
                            });
                        }else{
                            current_tbody = tbody_task
                            $('#select_task_head input:checkbox:not(:checked)').each(function () {
                                inactive_heads.push($('#thead_task > tr > td[head_id="'+$(this).attr('head_id')+'"]').index())
                            });
                        }

                        if (data['success'] === true) {
                            $(".task_row").removeClass('btn-success');
                            let new_task = render_task('project', data['task'], 'new');

                            if(data['task'].folder_id === 0){
                                current_tbody.prepend(new_task['task_row']);
                                if(data['calendar'] === null){
                                    tbody_side_task.prepend(new_task['side_task_row']);
                                }
                            }
                            else {
                                current_tbody.find('.task_folder_row[task_folder_id="'+data['task'].folder_id+'"').next('tr').after(new_task['task_row']);
                                if(data['calendar'] === null){
                                    tbody_side_task.find('.task_folder_row[task_folder_id="'+data['task'].folder_id+'"').next('tr').after(new_task['side_task_row']);
                                }
                            }
                            if(data['calendar'] !== null){
                                render_calendar_event(data['calendar']);
                            }



                            alertify.success("Successfully Added.");

                        } else {
                            console.log('error');
                        }


                        inactive_heads.forEach(function(head_indx, index) {
                            $('tr.new td:nth-child('+head_indx+')').css({'display':'none'})
                        })

                        $('tr.new').removeClass('new');

                        $('.task_employee').select2({
                            placeholder: "+",
                            tags: true,
                            allowClear: true,
                            createTag: function (params) {
                                if (params.term.indexOf('@') === -1) {return null;}
                                return { id: params.term, text: params.term }
                            }
                        });

                        $('input[class="event_date_calender"]').datepicker({format:'Y-m-d'});
                        current_tbody.find('tr[task_id="'+data['task'].id+'"]').addClass('show');

                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            function get_task_head() {
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_task_head',
                    method: 'get',
                    dataType: 'json',
                    data: {
                        'project_id': project_id
                    },
                    success: function (data) {
                        let current_thead = null;
                        if(task_from === 'contacts'){
                            current_thead = $('#thead_contacts');
                        }else{
                            current_thead = $('#thead_task');
                        }
                        current_thead.empty();
                        let tr = '<tr><td></td>';
                        select_task_head_options = [];

                        data.forEach(function(head, index) {
                            tr += '<td head_id="'+head.id+'" contenteditable="true" spellcheck="false">'+head.name+'</td>';
                            select_task_head_options.push(head)
                        });

                        tr += '</tr>'
                        current_thead.html(tr)

                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }


            $(document).on('change keyup input paste', '#thead_contacts > tr > td', function() {
                let data_id = ($(this).attr('head_id')).toString();
                let data_value = $(this).text();
                let data_of = 'name';
                update_task_head(data_id, data_of, data_value)
            });


            $(document).on('change keyup input paste', '#thead_task > tr > td', function() {
                let data_id = ($(this).attr('head_id')).toString();
                let data_value = $(this).text();
                let data_of = 'name';
                update_task_head(data_id, data_of, data_value)
            });



            $(document).on('change', 'input.task_head', function() {
                let data_id = ($(this).attr('head_id')).toString();
                if(task_from === 'contacts'){
                    let indx = parseInt($('#thead_contacts > tr > td[head_id="'+data_id+'"]').index())+1;
                    let data_value = 0;
                    let data_of = 'active';
                    if($(this).is(':checked')){
                        data_value = 1;
                        $('#tbody_contacts tr td:nth-child('+indx+'),#thead_contacts tr td:nth-child('+indx+')').show();
                    }else {
                        $('#tbody_contacts tr td:nth-child('+indx+'),#thead_contacts tr td:nth-child('+indx+')').hide();
                    }

                    update_task_head(data_id, data_of, data_value)
                }else{
                    let indx = parseInt($('#thead_task > tr > td[head_id="'+data_id+'"]').index())+1;
                    let data_value = 0;
                    let data_of = 'active';
                    if($(this).is(':checked')){
                        data_value = 1;
                        $('#tbody_task tr td:nth-child('+indx+'),#thead_task tr td:nth-child('+indx+')').show();
                    }else {
                        $('#tbody_task tr td:nth-child('+indx+'),#thead_task tr td:nth-child('+indx+')').hide();
                    }

                    update_task_head(data_id, data_of, data_value)
                }
            });

            function update_task_head(data_id, data_of, data_value){
                $.ajax({
                    url: base_url + 'api_update_task_head',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_id': data_id,
                        'data_of': data_of,
                        'data_value': data_value
                    },
                    success: function (data) {
                        if (data['success'] === true) {
                            if(task_from === 'contacts'){
                                $('#tbody_contacts > .project_task_folder_name').attr('colspan',(parseInt($('#select_contacts_head > input.task_head[type="checkbox"]:checked').length)+3));
                            }else{
                                $('#tbody_task > .project_task_folder_name').attr('colspan',(parseInt($('#select_task_head > input.task_head[type="checkbox"]:checked').length)+3));
                            }
                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }


            function get_task_folder() {
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_task_folder',
                    method: 'get',
                    dataType: 'json',
                    data: {
                        'project_id': project_id,
                        'company_id': company_id
                    },
                    success: function (data) {
                        tbody_task.empty();
                        tbody_contacts.empty();
                        tbody_side_task.empty();
                        $('#statusBox').empty();
                        task_folder_list = [];

                        data.forEach(function(folder, index) {
                            let new_folder = render_task_folder('project', folder)
                            if(task_from === 'contacts'){
                                tbody_contacts.append(new_folder);
                                tbody_side_task.append(new_folder);
                            }else{
                                tbody_task.append(new_folder);
                                tbody_side_task.append(new_folder);
                            }
                            task_folder_list.push({'id':folder.id, 'name':folder.name, 'project':folder.project})

                        });
                        get_task();
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            function get_task() {
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_task',
                    method: 'get',
                    dataType: 'json',
                    data: {
                        'project_id': project_id,
                        'company_id' : company_id
                    },
                    success: function (data) {
                        {#$('.task_row').remove();#}
                        {#$('#modal_wait').modal('show');#}
                        {#$('div[class="modal-backdrop show"]').remove();#}

                        let current_tbody = null;
                        let current_thead = null;
                        let select_head = null;

                        event_search_by_click = false

                        if(task_from === 'contacts'){
                            current_tbody = tbody_contacts;
                            current_thead = $('#thead_contacts');
                            select_head = $('#select_contacts_head');
                        }else{
                            current_tbody = tbody_task;
                            current_thead = $('#thead_task');
                            select_head = $('#select_task_head');
                        }

                        data.forEach(function(task, index) {
                            let new_task = render_task('project', task, '');
                            if(task.folder_id === 0){
                                current_tbody.prepend(new_task['task_row']);
                                tbody_side_task.prepend(new_task['side_task_row']);
                            }
                            else {
                                current_tbody.find('.task_folder_row[task_folder_id="'+task.folder_id+'"').next('tr').after(new_task['task_row']);
                                tbody_side_task.find('.task_folder_row[task_folder_id="'+task.folder_id+'"').next('tr').after(new_task['side_task_row']);
                            }
                        });

                        $('.task_employee').select2({
                            placeholder: "+",
                            tags: true,
                            allowClear: true,
                            createTag: function (params) {
                                if (params.term.indexOf('@') === -1) {return null;}
                                return { id: params.term, text: params.term }
                            }
                        });
                        $('input[class="event_date_calender"]').datepicker({format:'Y-m-d H:i'});
                        $('input[class="task_outreach_calender"]').datepicker({format:'Y-m-d H:i'});

                        select_head.empty();
                        select_task_head_options.splice(0, 1);
                        select_task_head_options.splice(-1, 1);
                        select_task_head_options.forEach(function(head, index) {
                            if(head.active === true){
                                select_head.append('<input class="task_head" head_id="'+head.id+'" type="checkbox" checked><label>'+head.name+'</label><br>');
                            }else {
                                select_head.append('<input class="task_head" head_id="'+head.id+'" type="checkbox"><label>'+head.name+'</label><br>');

                                if(task_from === 'contacts'){
                                    let indx = parseInt($('#thead_contacts > tr > td[head_id="'+head.id+'"]').index())+1;
                                    $('#tbody_contacts tr td:nth-child('+indx+'),#thead_contacts tr td:nth-child('+indx+')').hide();

                                }else{
                                    let indx = parseInt($('#thead_task > tr > td[head_id="'+head.id+'"]').index())+1;
                                    $('#tbody_task tr td:nth-child('+indx+'),#thead_task tr td:nth-child('+indx+')').hide();
                                }
                            }
                        });

                        $('#modal_wait').modal('hide');
                        if(task_from === 'contacts') {
                            $('#tbody_contacts > .project_task_folder_name').attr('colspan', (parseInt($('#select_contacts_head > input.task_head[type="checkbox"]:checked').length) + 3));
                        }else {
                            $('#tbody_task > .project_task_folder_name').attr('colspan', (parseInt($('#select_task_head > input.task_head[type="checkbox"]:checked').length) + 3));
                        }

                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            function get_employee_task_folder() {
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_employee_task_folder',
                    method: 'get',
                    dataType: 'json',
                    data: {
                        'company_id': company_id,
                        'employee_id': employee_id
                    },
                    success: function (data) {
                        tbody_task.empty();
                        tbody_side_task.empty();
                        $('#statusBox').empty();

                        data.forEach(function(folder, index) {
                            let new_folder = render_task_folder('employee', folder)
                            tbody_task.append(new_folder);
                            tbody_side_task.append(new_folder);
                        });
                        get_employee_task();
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            function get_employee_task() {
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_employee_task',
                    method: 'get',
                    dataType: 'json',
                    data: {
                        'company_id': company_id,
                        'employee_id': employee_id
                    },
                    success: function (data) {
                        $('.task_row').remove();
                        data.forEach(function(task, index) {

                            let new_task = render_task('employee', task, '');
                            if(task.folder_id === 0){
                                tbody_task.prepend(new_task['task_row']);
                                tbody_side_task.prepend(new_task['side_task_row']);
                            }
                            else {
                                tbody_task.find('.task_folder_row[task_folder_id="'+task.folder_id+'"').next('tr').after(new_task['task_row']);
                                tbody_side_task.find('.task_folder_row[task_folder_id="'+task.folder_id+'"').next('tr').after(new_task['side_task_row']);
                            }
                        });

                        $('.task_employee').select2({
                            placeholder: "+",
                            tags: true,
                            allowClear: true,
                            createTag: function (params) {
                                if (params.term.indexOf('@') === -1) {return null;}
                                return { id: params.term, text: params.term }
                            }
                        });
                        $('input[class="event_date_calender"]').datepicker({format:'Y-m-d H:i'});
                        event_search_by_click = false
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $(document).on('click', '.delete_task_folder', function() {
                let folder_id = ($(this).attr('task_folder_id')).toString();
                alertify.confirm("Confirmation", "Do you want to Delete ",
                    function(){
                        $('#tbody_task>tr[task_folder_id="'+folder_id+'"]').remove();
                        $('#tbody_task>tr[parent_folder="'+folder_id+'"]').removeAttr('parent_folder');
                        delete_task_folder(folder_id);
                    },
                    function(){alertify.error("Cancel")}
                ).set('defaultFocus', 'cancel');
            });

            function delete_task_folder(folder_id){
                $.ajax({
                    url: base_url + 'api_delete_task_folder',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'folder_id': folder_id
                    },
                    success: function (data) {
                        alertify.success("Successfully Deleted");
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $(document).on('click', '.task_folder_row', function() {
                $(this).find('.project_task_folder_name').prop('contenteditable',true);
            });

            $(document).on('dblclick', '.task_folder_row', function() {
                $(this).find('.project_task_folder_name').removeAttr('contenteditable');
            });

            $(document).on('change keyup input paste', '.project_task_folder_name', function() {
                let data_id = ($(this).attr('task_folder_id')).toString();
                let data_value = $(this).text();
                let data_of = 'name';
                update_task_folder(data_id, data_of, data_value)
            });

            function update_task_folder(data_id, data_of, data_value){
                $.ajax({
                    url: base_url + 'api_update_task_folder',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_id': data_id,
                        'data_of': data_of,
                        'data_value': data_value
                    },
                    success: function (data) {
                        if (data['success'] === true) {

                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }


            tbody_task.delegate(".task_row", "click", function(event){
                var $row = $(event.target);
                {#console.log($row.closest('tr').attr('task_id'));#}
                if($row[0].tagName !== "TR") $row = $row.parent();
                $row.toggleClass("selected");

                if(event.ctrlKey === false) {
                    $row.siblings().removeClass("selected");
                    selected_task_rows = []
                }else{
                    selected_task_rows = []
                    $('tr.task_row.selected').each(function(index,tr){
                        selected_task_rows.push($(tr).attr('task_id'))
                    });
                }

                task_id = $row.closest('tr').attr('task_id');
                $(".task_row").removeClass('select');
                $(this).addClass('select');

                $.ajax({
                    url: base_url + 'api_select',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'company_id': company_id,
                        'data_of':'task',
                        'task_id':task_id
                    },
                    success: function (data) {
                        if (data['success'] === true) {

                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            });

            $(document).on("focusout","#task_detail_name",function(){
                if($('#tbody_project tr.project_row.select').length>0){
                    get_project_calender();
                }
                if($('#tbody_employee tr.employee_row.select').length>0){
                    get_employee_calender();
                }
            });
            $(document).on('change keyup input paste', '#task_detail_name', function() {
                let data_id = ($(this).attr('task_id')).toString();
                {#let data_value = $(this).val().replace(/\r?\n/g, '<br/>');#}
                let data_value = $(this).html();
                let data_of = 'name';
                $('#tbody_side_task tr.task_row td.task_name[task_id="'+data_id+'"]').html(data_value)
                $('#tbody_task tr.task_row td.task_name[task_id="'+data_id+'"]').html(data_value)
                $('#tbody_calendar tr td span.event[task_id="'+data_id+'"] div:nth-child(3)').html(data_value)
                update_task(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '#task_detail_project', function() {
                let data_id = ($(this).attr('task_id')).toString();
                {#let data_value = $(this).val().replace(/\r?\n/g, '<br/>');#}
                let data_value = $(this).val();
                let data_of = 'project';
                update_task(data_id, data_of, data_value)
            });

            $(document).on('change', '#task_detail_shift', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = 0;
                let data_of = 'shift';
                if($(this).is(':checked')){
                    data_value = 1
                }
                update_task(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '#task_detail_email', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).val();
                let data_of = 'email';
                update_task(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '#task_detail_notes', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes';
                $('#tbody_task tr.task_row td.task_notes[task_id="'+data_id+'"]').html(data_value)

                update_task(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '#task_detail_notes1', function() {
                let data_id = ($(this).attr('task_id')).toString();
                {#let data_value = $(this).val().replace(/\r?\n/g, '<br/>');#}
                let data_value = $(this).html();
                let data_of = 'notes1';
                $('#tbody_task tr.task_row td.task_notes1[task_id="'+data_id+'"]').html(data_value)

                update_task(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '#task_detail_notes2', function() {
                let data_id = ($(this).attr('task_id')).toString();
                {#let data_value = $(this).val().replace(/\r?\n/g, '<br/>');#}
                let data_value = $(this).html();
                let data_of = 'notes2';
                $('#tbody_task tr.task_row td.task_notes2[task_id="'+data_id+'"]').html(data_value)
                update_task(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '#task_detail_notes3', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes3';
                $('#tbody_task tr.task_row td.task_notes3[task_id="'+data_id+'"]').html(data_value)

                update_task(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '#task_detail_notes4', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes4';
                $('#tbody_task tr.task_row td.task_notes4[task_id="'+data_id+'"]').html(data_value)

                update_task(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '#task_detail_notes5', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes5';
                $('#tbody_task tr.task_row td.task_notes5[task_id="'+data_id+'"]').html(data_value)

                update_task(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '#task_detail_notes6', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes6';
                $('#tbody_task tr.task_row td.task_notes6[task_id="'+data_id+'"]').html(data_value)

                update_task(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '#task_detail_notes7', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes7';
                $('#tbody_task tr.task_row td.task_notes7[task_id="'+data_id+'"]').html(data_value)

                update_task(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '#task_detail_notes8', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes8';
                $('#tbody_task tr.task_row td.task_notes8[task_id="'+data_id+'"]').html(data_value)

                update_task(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '#task_detail_notes9', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes9';
                $('#tbody_task tr.task_row td.task_notes9[task_id="'+data_id+'"]').html(data_value);
                update_task(data_id, data_of, data_value);
            });

            $(document).on('change set', '#task_detail_status', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).val();
                let data_of = 'status';
                $('#table_task #tbody_task tr.task_row td select.task_status').val(data_value)
                task_status(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '.task_name', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'name';
                let tbody_id = $(this).closest('tbody').attr('id');

                if(tbody_id === 'tbody_task'){
                    $('#tbody_side_task tr.task_row td.task_name[task_id="'+data_id+'"]').html(data_value)
                }else{
                    $('#tbody_task tr.task_row td.task_name[task_id="'+data_id+'"]').html(data_value)
                }

                update_task(data_id, data_of, data_value)
            });

            $(document).on('change', '.task_employee, #task_detail_employee', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).val().toString();
                let data_of = 'employee';
                update_task(data_id, data_of, data_value)

                if($('#tbody_project tr.project_row.select').length>0){
                    get_project_calender();
                }
                if($('#tbody_employee tr.employee_row.select').length>0){
                    get_employee_calender();
                }
            });

            $(document).on('change keyup input paste', '.task_email', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).text();
                let data_of = 'email';
                update_task(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '.task_notes', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes';
                update_task(data_id, data_of, data_value);
                $('.task_notes[task_id="'+data_id+'"]').find('img').attr('height','200px');
            });

            $(document).on('change keyup input paste', '.task_notes1', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes1';
                update_task(data_id, data_of, data_value);
                $('.task_notes1[task_id="'+data_id+'"]').find('img').attr('height','200px');

            });

            $(document).on('change keyup input paste', '.task_notes2', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes2';
                update_task(data_id, data_of, data_value);
                $('.task_notes2[task_id="'+data_id+'"]').find('img').attr('height','200px');
            });

            $(document).on('change keyup input paste', '.task_notes3', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes3';
                update_task(data_id, data_of, data_value);
                $('.task_notes3[task_id="'+data_id+'"]').find('img').attr('height','200px');
            });

            $(document).on('change keyup input paste', '.task_notes4', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes4';
                update_task(data_id, data_of, data_value);
                $('.task_notes4[task_id="'+data_id+'"]').find('img').attr('height','200px');
            });

            $(document).on('change keyup input paste', '.task_notes5', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes5';
                update_task(data_id, data_of, data_value);
                $('.task_notes5[task_id="'+data_id+'"]').find('img').attr('height','200px');
            });

            $(document).on('change keyup input paste', '.task_notes6', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes6';
                update_task(data_id, data_of, data_value);
                $('.task_notes6[task_id="'+data_id+'"]').find('img').attr('height','200px');
            });

            $(document).on('change keyup input paste', '.task_notes7', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes7';
                update_task(data_id, data_of, data_value);
                $('.task_notes7[task_id="'+data_id+'"]').find('img').attr('height','200px');
            });

            $(document).on('change keyup input paste', '.task_notes8', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes8';
                update_task(data_id, data_of, data_value);
                $('.task_notes8[task_id="'+data_id+'"]').find('img').attr('height','200px');
            });

            $(document).on('change keyup input paste', '.task_notes9', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).html();
                let data_of = 'notes9';
                update_task(data_id, data_of, data_value);
                $('.task_notes9[task_id="'+data_id+'"]').find('img').attr('height','200px');
            });

            $(document).on('change set', '.task_status', function() {
                let data_id = ($(this).attr('task_id')).toString();
                let data_value = $(this).val();
                let data_of = 'status';
                task_status(data_id, data_of, data_value)
            });


            $(document).on("click", ".select_task", function(e) {
                task_id = ($(this).attr('task_id')).toString();
                let sel = null;
                let data_value = '';
                let has_class = $(this).hasClass('bi-check-circle');
                sel = $('#tbody_task > tr > td > .task_status[task_id="'+task_id+'"]');

                if(has_class === true){
                    $(this).removeClass('bi-check-circle').addClass('bi-check-circle-fill')
                    data_value = sel.find('option:last').val();
                    sel.val(data_value)
                }else {
                    $(this).removeClass('bi-check-circle-fill').addClass('bi-check-circle')
                    data_value = sel.find('option:first').val();
                    sel.val(data_value)
                }

                task_status(task_id, 'status', data_value, has_class)
            });


            $(document).on("click", ".tasK_detail_select_task", function(e) {
                task_id = ($(this).attr('task_id')).toString();
                let sel = null;
                let data_value = '';
                let has_class = $(this).hasClass('bi-check-circle');
                sel = $('#task_detail_status[task_id="'+task_id+'"]');

                if(has_class === true){
                    $(this).removeClass('bi-check-circle').addClass('bi-check-circle-fill')
                    data_value = sel.find('option:last').val();
                    sel.val(data_value)
                }else {
                    $(this).removeClass('bi-check-circle-fill').addClass('bi-check-circle')
                    data_value = sel.find('option:first').val();
                    sel.val(data_value)
                }

                task_status(task_id, 'status', data_value, has_class)
            });

            function task_status(data_id, data_of, data_value, has_class){
                let sel = $('#tbody_task > tr > td > .task_status[task_id="'+task_id+'"]');
                let selected = $(sel).children(":selected");
                let style = selected.attr("style");
                $(sel).attr("style", style);
                $(sel).closest('td').attr("style", style);

                let row = $('tr[task_id="'+data_id+'"]');
                let event = $('#tbody_calendar tr td span.event[task_id="'+data_id+'"]');

                if(has_class === true){
                    row.addClass('done')
                    event.addClass('done')
                }
                else {
                    row.removeClass('done')
                    event.removeClass('done')
                }

                update_task(data_id, data_of, data_value);
            }

            function update_task(data_id, data_of, data_value){
                $.ajax({
                    url: base_url + 'api_update_task',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_id': data_id,
                        'data_of': data_of,
                        'data_value': data_value
                    },
                    success: function (data) {
                        if (data['success'] === true) {
                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $(document).on('click', '#task_detail_delete, .delete_task', function() {
                deleted_task_list.push(($(this).attr('task_id')).toString())
                delete_task()
            });

            function delete_task() {
                if(deleted_task_list.length === 0){
                    alertify.error("Please Select Task");
                }else {
                    alertify.confirm("Confirmation", "Do you want Delete this Task",
                        function(){
                            $.ajax({
                                url: base_url + 'api_delete_task',
                                method: 'POST',
                                type: 'json',
                                data: {
                                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                                    'selected_task_list': deleted_task_list.toString()
                                },
                                success: function (data) {
                                    if (data['success'] === true) {
                                        deleted_task_list.forEach(function(task_id, index) {

                                            $('#tbody_task > tr[task_id="'+task_id+'"]').remove();
                                            $('#tbody_contacts > tr[task_id="'+task_id+'"]').remove();
                                            $("#tbody_calendar > tr > td > span[task_id='"+task_id+"']").remove();
                                        });
                                        deleted_task_list = [];
                                        $('#modal_task_detail').modal('hide');

                                        alertify.success("Successfully Deleted.");
                                    } else {
                                        console.log('error');
                                    }
                                },
                                error: function () {
                                    console.log('error');
                                }
                            });
                        },
                        function(){alertify.error("Cancel")}).set('defaultFocus', 'cancel');
                }

            }


            let $draggedItem, $stickyItem, itemWidth, itemHeight, drag_folder_id, drag_project_id, drag_task_id;
            tbody_project.sortable({
                handle: '.project_drag',
                start: function(event, ui) {
                    $draggedItem = $(ui.item[0]);
                    drag_folder_id = $draggedItem.closest('tr.project_folder_row').attr('folder_id');
                    drag_project_id = $draggedItem.closest('tr.project_row').attr('project_id');

                    if (drag_folder_id !== undefined) {
                        $stickyItem= $('.project_folder_row[folder_id="'+drag_folder_id+'"]');
                    }

                    if (drag_project_id !== undefined) {
                        $stickyItem= $('.project_row[project_id="'+drag_project_id+'"]');
                    }

                    itemWidth = $draggedItem.width();
                    itemHeight = $draggedItem.height()
                },
                sort: function() {
                    if ($stickyItem !== undefined) {
                        $stickyItem.css({
                            "z-index": $draggedItem.css('z-index'),
                            "position": "absolute",
                            "width": itemWidth,
                            "height": itemHeight,
                            "left": $draggedItem.css('left'),
                            "top": $draggedItem.position().top + itemHeight,
                        });
                    }
                },
                stop: function() {
                    if ($stickyItem !== undefined) {
                        $stickyItem.insertAfter($draggedItem);
                        $stickyItem.removeAttr('style');

                        (tbody_project.find('.project_row')).each(function(index, project) {
                            let nfid = $(this).prevAll('tr.project_folder_row:first').attr('folder_id');
                            let ofid = $(this).attr('project_folder_id');
                            if(nfid !== ofid && nfid !== undefined){
                                $(this).removeClass("project-folder-"+ofid).addClass("project-folder-"+nfid).attr('project_folder_id', nfid);
                                update_project($(this).attr('project_id'), 'folder', nfid);
                            }
                            if (nfid === undefined) {
                                $(this).removeClass("project-folder-"+ofid).addClass("project-folder-0").attr('project_folder_id', 0);
                                update_project($(this).attr('project_id'), 'folder', 0);
                            }
                        });
                    }

                    let folder_list = [];
                    (tbody_project.find('.project_folder_row')).each(function(index, folder) {
                        folder_list.push({'order':index, 'folder_id':$(this).attr('folder_id')})
                    });

                    let project_list = [];
                    let c = 0;
                    let fid = 0;
                    (tbody_project.find('.project_row ')).each(function(index, project) {
                        let fidn = $(this).attr('project_folder_id');
                        if(fid !== fidn){ c = 0; fid = fidn; }
                        project_list.push({'order':c, 'project_id':$(this).attr('project_id')})
                        c += 1;
                    });

                    if(folder_list.length > 0){
                        update_sorting('project_folder', folder_list)
                    }

                    if(project_list.length > 0){
                        update_sorting('project', project_list)
                    }
                },
                cancel: 'input, textarea, button, select, option, [contenteditable], [draggable]'
            });

            tbody_task.sortable({
                handle: '.task_calendar',
                start: function(event, ui) {
                    $draggedItem = $(ui.item[0]);
                    drag_folder_id = $draggedItem.closest('.task_folder_row').attr('task_folder_id');
                    drag_task_id = $draggedItem.closest('.task_row').attr('task_id');

                    if (drag_folder_id !== undefined) {
                        $stickyItem= $('.task_folder_row[task_folder_id="'+drag_folder_id+'"]');
                    }

                    if (drag_project_id !== undefined) {
                        $stickyItem= $('.task_row[task_id="'+drag_task_id+'"]');
                    }

                    itemWidth = $draggedItem.width();
                    itemHeight = $draggedItem.height()
                },
                sort: function() {
                    if ($stickyItem !== undefined) {
                        $stickyItem.css({
                            "z-index": $draggedItem.css('z-index'),
                            "position": "absolute",
                            "width": itemWidth,
                            "height": itemHeight,
                            "left": $draggedItem.css('left'),
                            "top": $draggedItem.position().top + itemHeight,
                        });
                    }
                },
                stop: function() {

                    (tbody_task.find('.task_row')).each(function(index, task) {
                        let nfid = $(this).prevAll('tr.task_folder_row:first').attr('task_folder_id');
                        let ofid = $(this).attr('task_folder_id');
                        if(nfid !== ofid && nfid !== undefined){
                            $(this).removeClass("task-folder-"+ofid).addClass("task-folder-"+nfid).attr('task_folder_id', nfid);
                            update_task($(this).attr('task_id'), 'folder', nfid);

                        }
                        if (nfid === undefined) {
                            $(this).removeClass("task-folder-"+ofid).addClass("task-folder-0").attr('task_folder_id', 0);
                            update_task($(this).attr('task_id'), 'folder', 0);
                        }
                    });

                    let folder_list = [];
                    (tbody_task.find('.task_folder_row')).each(function(index, folder) {
                        folder_list.push({'order':index, 'folder_id':$(this).attr('task_folder_id')})
                    });

                    let task_list = [];
                    let c = 0;
                    let fid = 0;
                    (tbody_task.find('.task_row ')).each(function(index, task) {
                        let fidn = $(this).attr('task_folder_id');
                        if(fid !== fidn){ c = 0; fid = fidn; }
                        task_list.push({'order':c, 'task_id':$(this).attr('task_id')});
                        c += 1;
                    });

                    if(folder_list.length > 0){
                        update_sorting('task_folder', folder_list);
                    }

                    if(task_list.length > 0){
                        update_sorting('task', task_list);
                    }
                },
                cancel: 'input, textarea, button, select, option, [contenteditable], [draggable]'
            });

            tbody_contacts.sortable({
                handle: '.task_calendar',
                start: function(event, ui) {
                    $draggedItem = $(ui.item[0]);
                    drag_folder_id = $draggedItem.closest('.task_folder_row').attr('task_folder_id');
                    drag_task_id = $draggedItem.closest('.task_row').attr('task_id');

                    if (drag_folder_id !== undefined) {
                        $stickyItem= $('.task_folder_row[task_folder_id="'+drag_folder_id+'"]');
                    }

                    if (drag_project_id !== undefined) {
                        $stickyItem= $('.task_row[task_id="'+drag_task_id+'"]');
                    }

                    itemWidth = $draggedItem.width();
                    itemHeight = $draggedItem.height()
                },
                sort: function() {
                    if ($stickyItem !== undefined) {
                        $stickyItem.css({
                            "z-index": $draggedItem.css('z-index'),
                            "position": "absolute",
                            "width": itemWidth,
                            "height": itemHeight,
                            "left": $draggedItem.css('left'),
                            "top": $draggedItem.position().top + itemHeight,
                        });
                    }
                },
                stop: function() {

                    (tbody_contacts.find('.task_row')).each(function(index, task) {
                        let nfid = $(this).prevAll('tr.task_folder_row:first').attr('task_folder_id');
                        let ofid = $(this).attr('task_folder_id');
                        if(nfid !== ofid && nfid !== undefined){
                            $(this).removeClass("task-folder-"+ofid).addClass("task-folder-"+nfid).attr('task_folder_id', nfid);
                            update_task($(this).attr('task_id'), 'folder', nfid);

                        }
                        if (nfid === undefined) {
                            $(this).removeClass("task-folder-"+ofid).addClass("task-folder-0").attr('task_folder_id', 0);
                            update_task($(this).attr('task_id'), 'folder', 0);
                        }
                    });

                    let folder_list = [];
                    (tbody_contacts.find('.task_folder_row')).each(function(index, folder) {
                        folder_list.push({'order':index, 'folder_id':$(this).attr('task_folder_id')})
                    });

                    let task_list = [];
                    let c = 0;
                    let fid = 0;
                    (tbody_contacts.find('.task_row ')).each(function(index, task) {
                        let fidn = $(this).attr('task_folder_id');
                        if(fid !== fidn){ c = 0; fid = fidn; }
                        task_list.push({'order':c, 'task_id':$(this).attr('task_id')});
                        c += 1;
                    });

                    if(folder_list.length > 0){
                        update_sorting('task_folder', folder_list);
                    }

                    if(task_list.length > 0){
                        update_sorting('task', task_list);
                    }
                },
                cancel: 'input, textarea, button, select, option, [contenteditable], [draggable]'
            });

            function update_sorting(data_of, data_value ){
                $.ajax({
                    url: base_url + 'api_update_sorting',
                    method: 'POST',
                    headers: {
                        'Authorization': "Token " + localStorage.access_token
                    },
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_of':data_of,
                        'data_value': JSON.stringify(data_value)
                    },
                    success: function (data) {
                        if (data['success'] === true) {

                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            {#statusBox#}

            {# End Task #}

            {# Start Status #}

            $('#open_status_preset').click(function() {
                $('#status_preset_box').modal('show');
            });

            $('#save_status_preset').click(function() {
                select_status_preset();
                $('#status_preset_box').modal('hide');
            });

            function get_status_preset() {
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_status_preset',
                    method: 'get',
                    dataType: 'json',
                    data: {
                        'company_id': company_id
                    },
                    success: function (data) {
                        $('#tbody_status_preset > tr').remove();
                        let count = 1;
                        data.forEach(function(item, index) {
                            let tr = '';
                            if(item.status === true){
                                tr += '<tr class="status_preset_row btn-success" status_preset_id="'+item.id+'">';
                                status_preset_id = item.id;
                            } else {
                                tr += '<tr class="status_preset_row" status_preset_id="'+item.id+'">';
                            }
                            tr += '<td class="status_preset_name" contenteditable="true" spellcheck="false" status_preset_id="'+item.id+'">'+item.name+'</td>';
                            tr += '</tr>';
                            count += 1;
                            tbody_status_preset.append(tr);
                        });

                        tbody_status_preset.append('<tr><td colspan="2"><button id="add_status_preset" class="form-control btn btn-soft-secondary waves-effect waves-light btn-sm">Add Preset </button></td></tr>');
                        get_status_list();
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $(document).on('click', '#add_status_preset', function() {
                alertify.confirm("Confirmation", "Do you want add new Preset",
                    function(){
                        $.ajax({
                            url: base_url + 'api_create_status_preset',
                            method: 'POST',
                            type: 'json',
                            data: {
                                'csrfmiddlewaretoken': '{{ csrf_token }}',
                                'company_id': company_id
                            },
                            success: function (data) {
                                if (data['success'] === true) {
                                    get_status_preset();

                                    alertify.success("Successfully Added..!")
                                } else {
                                    console.log('error');
                                }
                            },
                            error: function () {
                                console.log('error');
                            }
                        });
                    },
                    function(){alertify.error("Cancel")}).set('defaultFocus', 'cancel');
            });

            $(document).on('change keyup input paste', '.status_preset_name', function() {
                let data_id = ($(this).attr('status_preset_id')).toString();
                let data_value = $(this).text();
                let data_of = 'name';
                update_status_preset(data_id, data_of, data_value)
            });

            function update_status_preset(data_id, data_of, data_value){
                $.ajax({
                    url: base_url + 'api_update_status_preset',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_id': data_id,
                        'data_of': data_of,
                        'data_value': data_value
                    },
                    success: function (data) {
                        if (data['success'] === true) {

                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $(document).on('click', '.status_preset_row', function() {
                status_preset_id = ($(this).attr('status_preset_id')).toString();
                $("#tbody_status_preset tr").removeClass('btn-success');
                $(this).addClass('btn-success');
                get_status_list();
            });

            function select_status_preset(){
                $.ajax({
                    url: base_url + 'api_active',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_of': 'status_preset',
                        'status_preset_id':status_preset_id,
                        'company_id':company_id,
                    },
                    success: function (data) {
                        if (data['success'] === true) {

                            get_status_list();
                            {#get_status();#}
                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            function get_status_list() {
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_status_list',
                    method: 'get',
                    dataType: 'json',
                    data: {
                        'status_preset_id': status_preset_id
                    },
                    success: function (data) {
                        $('#tbody_status_list > tr').remove();
                        let count = 1;
                        data.forEach(function(item, index) {
                            let tr = '';
                            tr += '<tr class="status_list_row" style="background-color: '+item.color+'">';
                            tr += '<td class="status_list_name" contenteditable="true" spellcheck="false" data_id="'+item.id+'">'+item.name+'</td>';
                            tr += '</tr>';
                            tbody_status_list.append(tr);
                            count += 1;
                        });
                        tbody_status_list.append('<tr><td colspan="5"><button id="add_status_list" class="form-control btn btn-soft-secondary waves-effect waves-light btn-sm">Add Status </button></td></tr>');
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $(document).on('click', '#add_status_list', function() {
                alertify.confirm("Confirmation", "Do you want add new Preset Item",
                    function(){
                        $.ajax({
                            url: base_url + 'api_create_status_list',
                            method: 'POST',
                            type: 'json',
                            data: {
                                'csrfmiddlewaretoken': '{{ csrf_token }}',
                                'status_preset_id': status_preset_id
                            },
                            success: function (data) {
                                if (data['success'] === true) {
                                    get_status_list();
                                    alertify.success("Successfully Added..!")
                                } else {
                                    console.log('error');
                                }
                            },
                            error: function () {
                                console.log('error');
                            }
                        });
                    },
                    function(){alertify.error("Cancel")}).set('defaultFocus', 'cancel');
            });

            $(document).on('change keyup input paste', '.status_list_name', function() {
                let data_id = ($(this).attr('data_id')).toString();
                let data_value = $(this).text();
                let data_of = 'name';
                update_status_list(data_id, data_of, data_value)
            });

            $(document).on('change keyup input paste', '.status_list_notes', function() {
                let data_id = ($(this).attr('data_id')).toString();
                let data_value = $(this).text();
                let data_of = 'notes';
                update_status_list(data_id, data_of, data_value)
            });

            function update_status_list(data_id, data_of, data_value){
                $.ajax({
                    url: base_url + 'api_update_status_list',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_id': data_id,
                        'data_of': data_of,
                        'data_value': data_value
                    },
                    success: function (data) {
                        if (data['success'] === true) {

                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });

            }

            {#now getting project status here#}
            function get_status() {
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_project_status',
                    method: 'get',
                    dataType: 'json',
                    data: {
                        'project_id': project_id
                    },
                    success: function (data) {
                        $('#tbody_status > tr').remove();
                        project_status_list = [];
                        let count = 1;
                        data.forEach(function(item, index) {
                            let id = item.id;
                            let color = item.color;
                            let name = item.name;
                            let employee = item.employee;
                            let active = item.select;
                            let tr = '';
                            tr += '<tr>';
                            tr += '<td width="1%"><div class="status_color" status_id="'+id+'" style="background-color: '+item.color+'"></div><input type="color" value="'+color+'" status_id="'+id+'" /></td>';
                            tr += '<td contenteditable="true" spellcheck="false" class="status_name rounded-2" status_id="'+id+'" style="background-color: '+color+'; border-radius: 10px">'+name+'</td>';
                            tr += '</tr>';
                            tbody_status.append(tr);
                            project_status_list.push({'id':id, 'name':name, 'color':color});

                        });
                    },
                    error: function () {
                        console.log('error');
                    }
                });

            }

            $(document).on('click', '.status_color', function() {
                let status_id = $(this).attr('status_id');
                let color_picker = $("input[type='color'][status_id="+status_id+"]");
                color_picker.click();
            });

            $(document).on('change', 'input[type="color"]', function() {
                let data_of = 'color';
                let data_id = $(this).attr('status_id');
                let data_value = ($(this).val()).toString();
                $("td[class='status_name rounded-2'][status_id='"+data_id+"']").css('background-color',data_value);
                $("div[class='status_color'][status_id='"+data_id+"']").css('background-color',data_value);
                $('.task_status').find('option[value="'+data_id+'"]').css('background-color',data_value);
                update_status(data_id, data_of, data_value);
            });

            $(document).on('change keyup input paste', '.status_name', function() {
                let data_id = ($(this).attr('status_id')).toString();
                let data_value = $(this).text();
                let data_of = 'name';
                update_status(data_id, data_of, data_value)
            });

            $(document).on('change', '.status_employee', function (e) {
                let data_of = 'employee';
                let data_id = $(this).attr('status_id');
                let data_value = ($(this).val()).toString();
                update_status(data_id, data_of, data_value);
                e.stopImmediatePropagation()
            });

            function update_status(data_id, data_of, data_value){
                $.ajax({
                    url: base_url + 'api_update_status',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_id': data_id,
                        'data_of': data_of,
                        'data_value': data_value
                    },
                    success: function (data) {
                        if (data['success'] === true) {

                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });

            }

            function add_status(){
                $.ajax({
                    url: base_url + 'api_add_status',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'project_id': project_id
                    },
                    success: function (data) {
                        if (data['success'] === true) {
                            get_status();
                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $.contextMenu({
                selector: '#nav-status',
                callback: function(key, options) {
                    if(key === 'add_status'){
                        add_status();
                    }
                },
                items: {
                    "add_status": {name: "Add Status", icon: "bi bi-list-ul"},
                }
            });

            {# End Status #}



            {# Start User Account #}
            function get_user_account() {
                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_user_account',
                    method: 'get',
                    dataType: 'json',
                    success: function (data) {
                        $('#user_notes').empty();
                        $('#matrics_link').attr('src','');
                        $('#calendar_link').attr('src','');

                        data.forEach(function(item, index) {
                            $('#matrics_link').attr('src',item.matrics_link);
                            $('#matrics_link_url').attr('value',item.matrics_link);

                            $('#calendar_link').attr('src',item.calendar_link);
                            $('#calendar_link_url').attr('value',item.calendar_link);

                            $('#user_notes').val(item.notes)

                            $('#smtp_username').val(item.username)
                            $('#smtp_password').val(item.password)
                            $('#smtp_server').val(item.server)
                            $('#smtp_port').val(item.port)
                        });
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $(document).on('change keyup input paste', '#smtp_username', function() {
                let data_value = $(this).val();
                update_user_account('username', data_value);
            });

            $(document).on('change keyup input paste', '#smtp_password', function() {
                let data_value = $(this).val();
                update_user_account('password', data_value);
            });

            $(document).on('change keyup input paste', '#smtp_server', function() {
                let data_value = $(this).val();
                update_user_account('server', data_value);
            });

            $(document).on('change keyup input paste', '#smtp_port', function() {
                let data_value = $(this).val();
                update_user_account('port', data_value);
            });

            $(document).on('change keyup input paste', '#calendar_link_url', function() {
                let data_value = $(this).val();
                $('#calendar_link').attr('src',data_value);
                update_user_account('calendar_link', data_value)
            });

            $(document).on('change keyup input paste', '#matrics_link_url', function() {
                let data_value = $(this).val();
                $('#matrics_link').attr('src',data_value);
                update_user_account('matrics_link', data_value)
            });

            function update_user_account(data_of, data_value){
                $.ajax({
                    url: base_url + 'api_update_user_account',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_of': data_of,
                        'data_value': data_value
                    },
                    success: function (data) {
                        if (data['success'] === true) {

                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            {# End User Notes #}

            {# Start Secret Key #}

            $(document).on('click', '#secret_key', function() {
                $.ajax({
                    url: base_url + 'api_user_account_key',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (data) {
                        alert(data['key'])
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            });

            {# End Secret Key #}

            {# Start Mailbox #}

            $(document).on('click', '#btn_sendbox', function() {
                $('div[class="modal-backdrop fade show"]').remove();
            });

            document.addEventListener('focusin', (e) => {
                if (e.target.closest(".tox-tinymce, .tox-tinymce-aux, .moxman-window, .tam-assetmanager-root") !== null) {
                    e.stopImmediatePropagation();
                }
            });

            tinymce.init({
                selector: 'textarea#txt',
                height : "400",
                branding: false,
                plugins: 'anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount checklist mediaembed casechange export formatpainter pageembed permanentpen powerpaste advtable advcode editimage tableofcontents mergetags inlinecss',
                toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table mergetags | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat',
                mergetags_list: [
                    { value: 'First.Name', title: 'First Name' },
                    { value: 'Email', title: 'Email' },
                ],
            });

            function IsEmail(email) {
                var regex = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;
                return regex.test(email);
            }

            $(document).on('click', '#send_email', function() {
                let content = tinyMCE.get('txt').getContent();

                let subject = $('#mail_subject').val();
                let to_bulk_email_exclude = $('#to_bulk_email_exclude').val();
                let mail_to_one = $('#mail_to').val();
                let mail_to_many = $('#to_bulk_email').val().toString();
                if(IsEmail(mail_to_one) === true || mail_to_many !== ''){

                    $.ajax({
                        url: base_url + 'send_email',
                        method: 'POST',
                        type: 'json',
                        data: {
                            'csrfmiddlewaretoken': '{{ csrf_token }}',
                            'content': content,
                            'mail_to_one': mail_to_one,
                            'mail_to_many': mail_to_many,
                            'to_bulk_email_exclude': to_bulk_email_exclude,
                            'subject': subject
                        },
                        beforeSend:function () {
                            alertify.success('your mail is sending please wait')
                        },
                        success: function (data) {
                            if (data['success'] === true) {
                                alertify.success('Mail Sent Successfully')
                            } else {
                                alertify.error('error');
                            }
                        },
                        error: function () {
                            alertify.error('error');
                        }
                    });

                }else {

                    alertify.error("Please select the receiver")
                }
            });




            $(document).on('click', '#smtp_configure_toggle', function() {
                $('#smtp_configure').toggle('show')
                $('#bulk_email').hide();
                $('#mail_to').show();
            });

            $(document).on('click', '#bulk_email_toggle', function() {
                $('#bulk_email').toggle('show')
                $('#smtp_configure').hide();
                $('#mail_to').val('').toggle('hide')
                let to_bulk_email = $('#to_bulk_email');

                $.ajax({
                    type: 'ajax',
                    url: base_url + 'api_task_folder_bulk_email',
                    method: 'get',
                    dataType: 'json',
                    data: {
                        'company_id': company_id
                    },
                    success: function (data) {
                        to_bulk_email.empty();
                        data.forEach(function(item, index) {
                            to_bulk_email.append('<option value="'+item.id+'">'+item.name+'</option>');
                        });

                        to_bulk_email.select2({
                            dropdownParent: $("#composemodal"),
                            placeholder: "Search Bulk Email List",
                            tags: true,
                            allowClear: true,
                            createTag: function (params) {
                                if (params.term.indexOf('@') === -1) {return null;}
                                return { id: params.term, text: params.term }
                            }
                        });
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            });

            {# End Mailbox #}


            {# Start ExportCSV Truecolor #}
            function downloadCSV(csv, filename) {
                let csvFile;
                let downloadLink;
                //define the file type to text/csv
                csvFile = new Blob([csv], { type: 'text/csv' });
                downloadLink = document.createElement("a");
                downloadLink.download = filename;
                downloadLink.href = window.URL.createObjectURL(csvFile);
                downloadLink.style.display = "none";
                document.body.appendChild(downloadLink);
                downloadLink.click();
            }

            $(document).on('click', '#btn_export_csv', function() {
                $.ajax({
                    url: base_url + "api_export_csv",
                    method: "POST",
                    data: {
                        'project_id': project_id,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (response) {
                        let first_id = response.id;
                        let csv = [];
                        let header = ["FolderName",	"TaskName", "", "DueDate", "Outreach", "Status", "Person", "Email",	"Notes", "Notes1", "Notes2", "Notes3", "Notes4", "Notes5", "Notes6", "Notes7", "Notes8", "Notes9"]
                        csv.push(header);
                        let trs = $('#table_task tbody tr');
                        if (trs.length > 0) {
                            for (let i = 0; i < trs.length; i++) {
                                let tr = [];
                                if(trs[i].classList.contains('task_row')) {
                                    let taskName = trs[i].querySelectorAll("td.task_name")[0].innerText;
                                    let open = "open";
                                    let dueDate = trs[i].querySelectorAll("td .event_date_calender")[0].value;
                                    let outReach = trs[i].querySelectorAll("td .task_outreach_calender")[0].value;
                                    let status;
                                    switch(trs[i].querySelectorAll("td .task_status")[0].value) {
                                        case first_id.toString():
                                            status = "Not Started";
                                            break;
                                        case (first_id + 1).toString():
                                            status = "In Progress";
                                            break;
                                        case (first_id + 2).toString():
                                            status = "Review";
                                            break;
                                        case (first_id + 3).toString():
                                            status = "Revision";
                                            break;
                                        case (first_id + 4).toString():
                                            status = "Not Started";
                                            break;
                                        case (first_id + 5).toString():
                                            status = "Not Started";
                                            break;
                                        case (first_id + 6).toString():
                                            status = "Not Started";
                                            break;
                                        case (first_id + 7).toString():
                                            status = "Not Started";
                                            break;
                                        case (first_id + 8).toString():
                                            status = "Done";
                                            break;
                                    }
                                    let person = '{{request.user.first_name}}';
                                    let email = trs[i].querySelectorAll("td.task_email")[0].innerText;
                                    let notes = trs[i].querySelectorAll("td.task_notes")[0].innerText;
                                    let notes1 = trs[i].querySelectorAll("td.task_notes1")[0].innerText;
                                    let notes2 = trs[i].querySelectorAll("td.task_notes2")[0].innerText;
                                    let notes3 = trs[i].querySelectorAll("td.task_notes3")[0].innerText;
                                    let notes4 = trs[i].querySelectorAll("td.task_notes4")[0].innerText;
                                    let notes5 = trs[i].querySelectorAll("td.task_notes5")[0].innerText;
                                    let notes6 = trs[i].querySelectorAll("td.task_notes6")[0].innerText;
                                    let notes7 = trs[i].querySelectorAll("td.task_notes7")[0].innerText;
                                    let notes8 = trs[i].querySelectorAll("td.task_notes8")[0].innerText;
                                    let notes9 = trs[i].querySelectorAll("td.task_notes9")[0].innerText;
                                    tr.push("");
                                    tr.push(taskName);
                                    tr.push(open);
                                    tr.push(dueDate);
                                    tr.push(outReach);
                                    tr.push(status);
                                    tr.push(person);
                                    tr.push(email);
                                    tr.push(notes);
                                    tr.push(notes1);
                                    tr.push(notes2);
                                    tr.push(notes3);
                                    tr.push(notes4);
                                    tr.push(notes5);
                                    tr.push(notes6);
                                    tr.push(notes7);
                                    tr.push(notes8);
                                    tr.push(notes9);
                                } else if (trs[i].classList.contains('task_folder_row')) {
                                    let folderName = trs[i].querySelectorAll("td.project_task_folder_name")[0].innerText;
                                    tr.push(folderName);
                                } else {
                                    tr.push("");
                                }
                                csv.push(tr.join(","));
                            }
                            downloadCSV(csv.join('\n'), "truecolor.csv");
                        } else {
                            alertify.error("There is no tasks to export");
                        }
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });
            });
            {# End ExportCSV Truecolor #}

            {# Start ImportCSV Truecolor #}
            $(document).on("click", ".cu-import__footer-back-label", function() {
                $('#tab_tasklist_container').css("display", "");
                $('#import_container').css("display", "none");
            });

            function create_imported_task(data){
                $.ajax({
                    url: base_url + 'api_create_imported_task',
                    method: 'POST',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'data_value': JSON.stringify(data)
                    },
                    success: function (data) {
                        let current_tbody= null;
                        if(task_from === 'contacts'){
                            current_tbody = tbody_contacts
                        }else{
                            current_tbody = tbody_task
                        }

                        if (data['success'] === true) {
                            $(".task_row").removeClass('btn-success');
                            let new_task = render_imported_task('project', data['task']);

                            if(data['task'].folder_id === 0){
                                current_tbody.prepend(new_task['task_row']);
                                if(data['calendar'] === null){
                                    tbody_side_task.prepend(new_task['side_task_row']);
                                }
                            }
                            else {
                                current_tbody.find('.task_folder_row[task_folder_id="'+data['task'].folder_id+'"').next('tr').after(new_task['task_row']);
                                if(data['calendar'] === null){
                                    tbody_side_task.find('.task_folder_row[task_folder_id="'+data['task'].folder_id+'"').next('tr').after(new_task['side_task_row']);
                                }
                            }
                            if(data['calendar'] !== null){
                                render_calendar_event(data['calendar']);
                            }
                            alertify.success("Successfully Added.");

                        } else {
                            console.log('error');
                        }

                        $('.task_employee').select2({
                            placeholder: "+",
                            tags: true,
                            allowClear: true,
                            createTag: function (params) {
                                if (params.term.indexOf('@') === -1) {return null;}
                                return { id: params.term, text: params.term }
                            }
                        });

                        $('input[class="event_date_calender"]').datepicker({format:'Y-m-d'});
                        current_tbody.find('tr[task_id="'+data['task'].id+'"]').addClass('show');


                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            function create_task_folder(folder_name="My Folder") {
                $.ajax({
                    url: base_url + 'api_create_task_folder',
                    method: 'POST',
                    type: 'json',
                    data: {
                        'folder_name':folder_name,
                        'company_id': company_id,
                        'project_id': project_id,
                        'folder_from': task_folder_from,
                        'folder_id': current_folder_id,
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    success: function (data) {
                        current_folder_id = data.folder.id;
                        console.log("task folder is created");
                        if (data['success'] === true) {
                            let current_tbody= null;
                            if(task_folder_from === 'contacts'){
                                current_tbody = tbody_contacts
                            }else{
                                current_tbody = tbody_task
                            }
                            let task_folder = current_tbody.find('.task_folder_row:first');

                            if(task_folder.length === 0){
                                current_tbody.append(render_task_folder(task_folder_from, data['folder']))
                                tbody_side_task.append(render_task_folder(task_folder_from, data['folder']))
                            }else {
                                task_folder.before(render_task_folder(task_folder_from, data['folder']))
                                tbody_side_task.before(render_task_folder(task_folder_from, data['folder']))
                            }
                        } else {
                            console.log('error');
                        }
                    },
                    error: function () {
                        console.log('error');
                    }
                });
            }

            $(document).on('click', '#btn_import_csv', function() {
                $('#tab_tasklist_container').css("display", "none");
                $('#import_container').css("display", "block");
            });

            $('#upload_button').on('click', async function() {
                $("#csvfile").click();
            });

            $('#csvfile').change(function(evt) {
                const file = evt.target.files[0];
                const reader = new FileReader();
                const extension = file.name.split('.').pop().toLowerCase();

                if (extension == 'csv') {
                    reader.readAsText(file);
                } else if (extension == 'xls' || extension == 'xlsx') {
                    reader.readAsBinaryString(file);
                } else {
                    alert('Unsupported file type. Please select a CSV or Excel file.');
                }

                reader.onload = function(e) {
                    let folder_name_indexes = [];
                    let rows = [];
                    if (extension == 'csv') {
                        const csvrows = e.target.result.split("\r\n");
                        let fieldName = csvrows[0].split(",");
                        console.log("fieldName", fieldName)
                        for (let i = 1; i < csvrows.length - 1; i++) {
                            if (csvrows[i].slice().replace(/,/g, "").length == 0) continue;
                            let csvrow = csvrows[i].split(",");
                            let row = {};
                            for (let j = 0; j < fieldName.length; j++) {
                                row[fieldName[j]] = csvrow[j];
                            }
                            rows.push(row);
                        }
                    } else if (extension == 'xlsx' || extension == 'xls') {
                        const binaryData = e.target.result;
                        const workbook = XLSX.read(binaryData, { type: "binary" });
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: "" });
                        let fieldName = jsonData[0];
                        for (let i = 1; i < jsonData.length; i++) {
                            if (jsonData[i].join(",").length == 0) continue;
                            let row = {};
                            for (let j = 0; j < fieldName.length; j++) {
                                if (fieldName[j].length != 0) {
                                    row[fieldName[j]] = jsonData[i][j];
                                }
                            }
                            rows.push(row);
                        }
                    }
                    folder_name_indexes.push(0);
                    for (let i = 1; i < rows.length; i++) {
                        if(rows[i]["FolderName"] != "") { folder_name_indexes.push(i)}
                    }
                    folder_name_indexes.push(rows.length);
                    console.log("rows", rows);
                    console.log("folder_name_indexes", folder_name_indexes);
                    for (let i = 0; i < folder_name_indexes.length -1; i++) {
                        let folder_tasks = rows.slice(folder_name_indexes[i], folder_name_indexes[i + 1]);
                        console.log("folder_tasks", folder_tasks)
                        if (i == 0) {
                            console.log("folder_tasks", folder_tasks)
                            for (let j = 0; j < folder_tasks.length; j++) {
                                create_imported_task({
                                        'task_from': task_from,
                                        'company_id': company_id,
                                        'project_id': project_id,
                                        'folder_id': 0,
                                        'employee_id': employee_id,
                                        'task_datetime': '',
                                        'task': folder_tasks[j]
                                    }
                                );
                            }
                        } else {
                            $.ajax({
                                url: base_url + 'api_create_folder_tasks',
                                method: 'POST',
                                type: 'json',
                                data: {
                                    'task_info': JSON.stringify(folder_tasks),
                                    'company_id': company_id,
                                    'project_id': project_id,
                                    'folder_from': task_folder_from,
                                    'employee_id': employee_id,
                                    'task_datetime': "",
                                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                                },
                                success: function (data) {
                                    console.log(data["task"])
                                    if (data['success'] === true) {
                                        let current_tbody= null;
                                        if(task_folder_from === 'contacts'){
                                            current_tbody = tbody_contacts
                                        }else{
                                            current_tbody = tbody_task
                                        }
                                        let task_folder = current_tbody.find('.task_folder_row:first');

                                        if(task_folder.length === 0){
                                            current_tbody.append(render_task_folder(task_folder_from, data['folder']))
                                            tbody_side_task.append(render_task_folder(task_folder_from, data['folder']))
                                        } else {
                                            task_folder.before(render_task_folder(task_folder_from, data['folder']))
                                            tbody_side_task.before(render_task_folder(task_folder_from, data['folder']))
                                        }
                                        for (let i = 0; i < data['task'].length; i++) {
                                            $(".task_row").removeClass('btn-success');
                                            let new_task = render_imported_task('project', data['task'][i]);
                                            current_tbody.find('.task_folder_row[task_folder_id="' + data.folder_id + '"').next('tr').after(new_task['task_row']);
                                            if(data['calendar'] === null){
                                                tbody_side_task.find('.task_folder_row[task_folder_id="'+ data.folder_id + '"').next('tr').after(new_task['side_task_row']);
                                            }
                                            if(data['calendar'] !== null){
                                                render_calendar_event(data['calendar']);
                                            }
                                            alertify.success("Successfully Added.");
                                        }
                                    } else {
                                        console.log('error');
                                    }
                                },
                                error: function () {
                                    console.log('error');
                                }
                            });
                        }
                    }
                }
                $('#tab_tasklist_container').css("display", "");
                $('#import_container').css("display", "none");
            });
            {# End ImportCSV Truecolor #}

        });
    </script>

{% endblock js %}